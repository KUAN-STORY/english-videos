<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ¨å»£åˆ†æ½¤ï½œBookWide</title>
  <link rel="icon" href="../assets/favicon.svg">
  <style>
    :root {
      --bg: #0b1320;
      --panel: #0f172a;
      --card: #0f172a;
      --text: #e5ebff;
      --muted: #8fa1c7;
      --brand: #448aff;
      --brand-2: #1e60ff;
      --ring: rgba(68,138,255,.25);
      --border: #20304f;
      --white: #fff;
    }
    html,body{background:#0b1320;color:var(--text);margin:0}
    .wrap{max-width:1000px;margin:0 auto;padding:28px 20px 56px}
    .page-title{font-size:28px;font-weight:800;letter-spacing:.02em;margin:0 0 16px}
    .lead{color:var(--muted);margin:0 0 22px;font-size:16px;line-height:1.7}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px 18px}
    .row{display:flex;gap:12px;align-items:center}
    .input{
      flex:1;background:#0b1320;border:1px solid var(--border);color:var(--text);
      border-radius:12px;padding:14px 14px;font-size:15px;outline:none;
    }
    .input:focus{border-color:var(--brand);box-shadow:0 0 0 6px var(--ring)}
    .btn{
      background:linear-gradient(180deg,var(--brand),var(--brand-2));
      border:0;color:#fff;padding:12px 16px;border-radius:12px;
      font-weight:700;letter-spacing:.02em;cursor:pointer;min-width:112px
    }
    .btn.secondary{background:#19233a}
    .muted{color:var(--muted)}
    .code{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .section{margin-top:28px}
    .faq h3{margin:18px 0 8px;font-size:18px}
    .faq p{margin:0 0 10px;color:var(--muted);line-height:1.8}
    .badge{display:inline-block;background:#142244;border:1px solid var(--border);
      color:#a7c0ff;font-weight:700;border-radius:999px;padding:6px 10px;font-size:12px;margin-left:10px}
    .toast{position:fixed;right:16px;bottom:18px;background:#101a33;border:1px solid var(--border);
      color:#d2e2ff;padding:12px 14px;border-radius:12px;opacity:0;transform:translateY(8px);
      transition:.25s;pointer-events:none}
    .toast.show{opacity:1;transform:translateY(0)}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media (min-width:760px){
      .grid{grid-template-columns:1fr 1fr}
    }
    a, a:visited{color:#a7c0ff;text-decoration:none}
    .small{font-size:13px}
    .header{
      display:flex;justify-content:space-between;align-items:center;margin-bottom:12px
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <h1 class="page-title">æ¨å»£åˆ†æ½¤</h1>
      <a class="small muted" href="../index.html">â† å›é¦–é </a>
    </div>

    <p class="lead">
      å°‡å°ˆå±¬é€£çµåˆ†äº«çµ¦æœ‹å‹ï¼Œæ¯ç•¶ä»–å€‘è¨»å†Šä¸¦è¨‚é–±èª²ç¨‹ï¼Œä½ éƒ½èƒ½ç²å¾—åˆ†æ½¤çå‹µ ğŸ‰
      <span id="who" class="badge">è¼‰å…¥ä¸­â€¦</span>
    </p>

    <div class="card">
      <div class="row" style="margin-bottom:10px">
        <strong>æˆ‘çš„æ¨å»£é€£çµ</strong>
      </div>
      <div class="row">
        <input id="refLink" class="input" type="text" readonly value="è¼‰å…¥ä¸­â€¦">
        <button id="btnCopy" class="btn">è¤‡è£½é€£çµ</button>
      </div>

      <div class="row" style="margin-top:14px">
        <div class="muted small">
          æ¨è–¦ç¢¼ï¼š<span id="refCode" class="code">â€”</span>
        </div>
        <div style="flex:1"></div>
        <button id="btnCopyCode" class="btn secondary">è¤‡è£½æ¨è–¦ç¢¼</button>
      </div>
    </div>

    <div class="section grid">
      <div class="card faq">
        <h3>å¦‚ä½•æ¨è–¦æœ‹å‹ï¼Ÿ</h3>
        <p>ä½¿ç”¨ã€Œå°ˆå±¬é€£çµã€å…¬é–‹åˆ†äº«æˆ–æ˜¯è¤‡è£½è²¼çµ¦æœ‹å‹ï¼Œé‚€è«‹æœ‹å‹ä½¿ç”¨ä½ æä¾›çš„é€£çµã€æ¨è–¦ç¢¼ä»¥ 9 æŠ˜å„ªæƒ è³¼è²·ã€‚</p>

        <h3>æ€éº¼æ‰ç®—æ¨è–¦æˆåŠŸï¼Ÿ</h3>
        <p>ç•¶æœ‹å‹é€éæ‚¨çš„ã€Œå°ˆå±¬é€£çµã€æˆåŠŸè³¼è²·ï¼ˆä¸”è¨‚å–®æœªé€€æ¬¾ï¼‰ï¼Œå³ç®—æ¨è–¦æˆåŠŸã€‚è¨‚å–®æˆç«‹å¾Œï¼Œ14 å¤©å¾Œç®—æ¨è–¦æˆåŠŸã€‚</p>

        <h3>ä»€éº¼æ˜¯æ¨è–¦é‡‘ï¼Ÿ</h3>
        <p>æ¨è–¦é‡‘å°±æ˜¯ç¾é‡‘å›é¥‹å”·ï¼æ¯æˆåŠŸæ¨è–¦ä¸€ä½æœ‹å‹ï¼Œæ‚¨å³å¯ç²å¾—æ¨è–¦é‡‘ã€‚æ¨è–¦ä¸€ç­†å¯ä»¥ç²å¾— 200 å…ƒæ¨è–¦é‡‘ã€‚</p>

        <h3>å¦‚ä½•é ˜å–ï¼Ÿ</h3>
        <p>ç•¶æ¯æ¬¡ã€Œæœªé ˜å–æ¨è–¦é‡‘ã€æ»¿è¶³ 1,000 å…ƒå³å¯é ˜å–ï¼ŒBookWide åœ˜éšŠæœƒå¯©æ ¸æ‚¨çš„è³‡æ–™ï¼Œå¯©æ ¸å®Œæˆå¾Œï¼Œå°‡æ–¼ç”³è«‹çš„ã€Œæ¬¡æœˆã€å°‡æ¨è–¦é‡‘åŒ¯å…¥æ‚¨æä¾›çš„å¸³æˆ¶ä¸­ã€‚</p>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px">ä½¿ç”¨å°æé†’</h3>
        <p class="muted small" style="line-height:1.8">
          â€¢ å°ˆå±¬é€£çµçš„å›ºå®šå…¥å£ï¼š<br>
          <span class="code">https://bookwide.github.io/EduEnglish/index.html</span><br><br>
          â€¢ æˆ‘å€‘æœƒåœ¨é€£çµå¾Œé¢å¸¶ä¸Šä½ çš„æ¨è–¦ç¢¼ï¼ˆ<span class="code">?ref=ä½ çš„ID</span>ï¼‰ã€‚<br>
          â€¢ å¥½å‹é€éä½ çš„é€£çµå®Œæˆè¨‚é–±å¾Œï¼Œç³»çµ±æœƒè‡ªå‹•æ­¸å±¬çµ¦ä½ ã€‚<br>
          â€¢ å¦‚éœ€å”åŠ©ï¼Œæ­¡è¿å¯„ä¿¡è‡³ <a href="mailto:support@bookwide.com">support@bookwide.com</a>ã€‚
        </p>
      </div>
    </div>
  </div>

  <div id="toast" class="toast">å·²è¤‡è£½</div>

  <script type="module">
  import { supabase } from '../../supa.js';

  const REF_BASE = 'https://bookwide.github.io/EduEnglish/index.html';

  const linkInput = document.querySelector('#refLink');
  const codeText  = document.querySelector('#refCode');
  const btnCopyLink = document.querySelector('#btnCopyLink');
  const btnCopyCode = document.querySelector('#btnCopyCode');
  const pageBadge   = document.querySelector('#pageBadge');

  function genCodeFromUid(uid) { return uid.replace(/-/g, '').slice(0, 10); }

  async function ensureLogin() {
    const { data: { session } } = await supabase.auth.getSession();
    if (!session) { alert('è«‹å…ˆç™»å…¥'); location.href = '../login-test.html'; return null; }
    return session.user;
  }

  async function loadReferral() {
    const user = await ensureLogin(); if (!user) return;
    const { data: profile, error } = await supabase
      .from('profiles')
      .select('id, referral_code, referral_url')
      .eq('id', user.id)
      .single();
    if (error) { console.error(error); alert('è®€å–è³‡æ–™å¤±æ•—'); return; }

    if (!profile.referral_code || !profile.referral_url) {
      const code = genCodeFromUid(user.id);
      const url  = `${REF_BASE}?ref=${encodeURIComponent(code)}`;
      const { error: upErr } = await supabase
        .from('profiles')
        .update({ referral_code: code, referral_url: url })
        .eq('id', user.id);
      if (upErr) { console.error(upErr); alert('å»ºç«‹å°ˆå±¬é€£çµå¤±æ•—'); return; }
      profile.referral_code = code;
      profile.referral_url  = url;
    }

    linkInput.value = profile.referral_url;
    codeText.textContent = `æ¨è–¦ç¢¼ï¼š${profile.referral_code}`;
    pageBadge.textContent = 'æ¨å»£åˆ†æ½¤';
  }

  function copy(str) {
    navigator.clipboard.writeText(str).then(
      () => alert('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿'),
      () => alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–')
    );
  }
  btnCopyLink?.addEventListener('click', () => copy(linkInput.value || ''));
  btnCopyCode?.addEventListener('click', () =>
    copy((codeText.textContent || '').replace('æ¨è–¦ç¢¼ï¼š',''))
  );

  loadReferral();
</script>

</body>
</html>



