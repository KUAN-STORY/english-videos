<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BookWide</title>

  <!-- 現有全站共用 Supabase 設定（你倉庫已放 /english-videos/account/_shared.js） -->
  <script defer src="./account/_shared.js"></script>

  <style>
    :root{
      --bg:#0b1324; --panel:#0f172a; --ink:#e6efff; --muted:#9fb0c9; --accent:#3c7cff;
      --border:#1f2a44; --pill:#183459; --hover:#13223a;
    }
    html,body{height:100%;margin:0;background:#0b1324;color:var(--ink);font-family:ui-sans-serif,system-ui,Noto Sans TC;}
    a,button{color:var(--ink)}
    .btn{background:#13233f;border:1px solid #24446f;border-radius:10px;padding:8px 14px;cursor:pointer}
    .btn:hover{background:#183459}
    header{
      display:flex;align-items:center;justify-content:space-between;
      padding:14px 20px;background:var(--panel);border-bottom:1px solid var(--border);
      position:sticky;top:0;z-index:5;
    }
    .nav-left{display:flex;gap:16px;align-items:center}
    .nav-right{display:flex;gap:16px;align-items:center}
    .brand{font-weight:800;font-size:20px}
    .muted{color:var(--muted)}

    /* 右上 email 文字 */
    #userEmailLabel{
      padding:8px 12px;border:1px solid #24446f;border-radius:10px;background:#13233f;
      cursor:pointer;user-select:none;display:none; /* 未登入預設不顯示 */
    }

    /* 下拉選單 */
    .menu{position:absolute;right:20px;top:64px;width:220px;background:#0e2038;border:1px solid #183459;border-radius:12px;display:none}
    .menu.open{display:block}
    .menu a,.menu button{
      display:block;width:100%;text-align:left;background:transparent;border:0;color:var(--ink);
      padding:12px 16px;font-size:16px;cursor:pointer
    }
    .menu a:hover,.menu button:hover{background:#112340}
    .sep{height:1px;background:#183459;margin:4px 0}

    /* 內容區（示意，保留你的既有版面可替換） */
    .hero{max-width:1200px;margin:24px auto 0;padding:0 16px}
    .pill{background:var(--pill);border:1px solid #24446f;border-radius:999px;padding:10px 16px;display:inline-flex;gap:8px;align-items:center}
    .grid{max-width:1200px;margin:18px auto;padding:0 16px;display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
    .card{background:#0e2038;border:1px solid #183459;border-radius:14px;padding:16px;min-height:120px}

    /* 登入對話框 */
    dialog#authDialog{
      border:1px solid #20436e;border-radius:16px;background:#0e2038;color:var(--ink);width:420px;max-width:calc(100% - 32px)
    }
    dialog::backdrop{background:rgba(0,0,0,.55)}
    .fg{display:flex;flex-direction:column;gap:6px;margin:12px 0}
    .fg input{background:#0b1b30;border:1px solid #24446f;border-radius:10px;padding:10px 12px;color:var(--ink)}

    /* 行動端 email 選單不漂移 */
    @media (max-width:768px){
      .menu{right:12px;top:58px}
    }
  </style>
</head>
<body>
  <!-- 頁首（保留你的結構；右側只放【登入】【登出】【Email 文字】） -->
  <header>
    <div class="nav-left">
      <div class="brand">BookWide</div>
      <button class="btn muted" onclick="location.href='./plans.html'">方案價格</button>
      <button class="btn muted" onclick="location.href='./guide.html'">服務導覽</button>
    </div>

    <div class="nav-right">
      <!-- 未登入顯示：登入；已登入顯示：Email + 下拉選單 + 登出 -->
      <span id="userEmailLabel" aria-haspopup="menu" aria-expanded="false"></span>
      <button id="btnLogin" class="btn">登入</button>
      <button id="btnLogout" class="btn" style="display:none">登出</button>
    </div>

    <!-- 下拉選單（登入後才會透過 JS 打開/關閉） -->
    <nav id="accMenu" class="menu" aria-label="帳號選單">
      <a href="./account/profile.html">我的資料</a>
      <a href="./account/favorites.html">收藏影片</a>
      <a href="./account/learning.html">學習曲線</a>
      <div class="sep"></div>
      <button id="menuLogout">登出</button>
    </nav>
  </header>

  <!-- 你的主內容（保留；若需替換，直接把下面 .hero 與 .grid 區塊換成你的現有內容即可） -->
  <section class="hero">
    <div class="pill"><span>看影片、做測驗、背單字 —— 一頁完成</span></div>
  </section>
  <section class="grid">
    <div class="card">這裡放你的首頁卡片 / 影片列表…</div>
    <div class="card">這裡放你的首頁卡片 / 影片列表…</div>
    <div class="card">這裡放你的首頁卡片 / 影片列表…</div>
  </section>

  <!-- === Email+密碼登入（延用，目前僅此方式） === -->
  <dialog id="authDialog">
    <form id="authForm" method="dialog">
      <h3 style="margin:6px 0 12px">登入</h3>
      <div class="fg">
        <label for="email">Email</label>
        <input id="email" name="email" type="email" autocomplete="email" placeholder="you@example.com" required />
      </div>
      <div class="fg">
        <label for="password">密碼</label>
        <input id="password" name="password" type="password" autocomplete="current-password" required />
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
        <button type="button" class="btn" id="btnCancelLogin">取消</button>
        <button type="submit" class="btn" id="btnDoLogin">送出</button>
      </div>
      <div id="authMsg" class="muted" style="margin-top:6px"></div>
    </form>
  </dialog>

  <script>
    // 等 _shared.js 建好 window.supabase（你倉庫已有）
    (function(){
      const byId = (id)=>document.getElementById(id);

      const elLogin  = byId('btnLogin');
      const elLogout = byId('btnLogout');
      const elEmail  = byId('userEmailLabel');
      const menu     = byId('accMenu');

      const dlg      = byId('authDialog');
      const frm      = byId('authForm');
      const msg      = byId('authMsg');
      const btnCancel= byId('btnCancelLogin');
      const menuLogout = byId('menuLogout');

      // 點 Email 顯示/收起選單
      function toggleMenu(open){
        const want = (typeof open==='boolean')? open : !menu.classList.contains('open');
        menu.classList.toggle('open', want);
        elEmail.setAttribute('aria-expanded', want?'true':'false');
      }
      elEmail.addEventListener('click', ()=>toggleMenu());

      // 點頁面其他處收起
      document.addEventListener('click', (e)=>{
        if(menu.classList.contains('open')){
          const inMenu = menu.contains(e.target) || elEmail.contains(e.target);
          if(!inMenu) toggleMenu(false);
        }
      }, true);

      // 顯示登入對話框
      elLogin.addEventListener('click', ()=>{
        msg.textContent='';
        frm.reset();
        dlg.showModal();
      });
      btnCancel.addEventListener('click', ()=>dlg.close());

      // 送出登入
      frm.addEventListener('submit', async (e)=>{
        e.preventDefault();
        msg.textContent='登入中…';
        const email = frm.email.value.trim();
        const password = frm.password.value;
        try{
          const { data, error } = await window.supabase.auth.signInWithPassword({ email, password });
          if(error) throw error;
          dlg.close();
          msg.textContent='';
          await refreshUI();         // 登入成功 → 重繪 UI
        }catch(err){
          msg.textContent = '登入失敗：' + (err?.message || err);
        }
      });

      // 登出（兩個地方：右上按鈕、下拉選單）
      async function doLogout(){
        try{ await window.supabase.auth.signOut(); }catch{}
        toggleMenu(false);
        await refreshUI();
      }
      elLogout.addEventListener('click', doLogout);
      menuLogout.addEventListener('click', doLogout);

      // UI 狀態重繪
      async function refreshUI(){
        const { data:{ user } } = await window.supabase.auth.getUser();
        if(user){
          // 已登入
          elEmail.style.display = 'inline-flex';
          elEmail.textContent = user.email || '已登入';
          elLogin.style.display  = 'none';
          elLogout.style.display = 'inline-flex';
        }else{
          // 未登入
          elEmail.style.display = 'none';
          elEmail.textContent   = '';
          elLogin.style.display  = 'inline-flex';
          elLogout.style.display = 'none';
          toggleMenu(false);
        }
      }

      // 初始載入
      document.addEventListener('DOMContentLoaded', refreshUI);
      // auth 變更（跨頁回來或 token 刷新）
      window.supabase.auth.onAuthStateChange((_evt,_sess)=>refreshUI());
    })();
  </script>
</body>
</html>




















































































































