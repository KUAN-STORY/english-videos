<!-- Player patched V20251007-18: resize recursion guard + UI enforcement; no other changes -->
<!-- Player patched V20251007-17: badge unify, login hide, stronger mobile pager; no other changes -->
<!-- Player patched V20251007-16: hide login, dynamic build tag, portrait pager fix; no other changes -->
<!-- Player patched V20251007-15: mobile horizontal pager added; no other changes -->
<!-- Player patched V20251007-14: cues format protection added; no other changes -->
<!-- Player patched V20251007-13: cues observer patch added; no other changes -->
<!-- Player patched V20251007-12: cues vertical stack + Supabase protection; no other changes -->
!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>è‹±èªå½±ç‰‡æ’­æ”¾å™¨</title>
<style>
  :root{ --bg:#0b1324; --panel:#0f172a; --border:#1f2a44; --ink:#e6efff; --muted:#9fb0c9; --accent:#3c7cff; }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,"Noto Sans TC"}
  h1{font-size:20px;margin:0}
  .btn{background:#13233f;border:1px solid #24446f;border-radius:10px;padding:8px 12px;color:#fff;cursor:pointer}
  .btn.blue{background:#14335f;border-color:#2c5aa3}
  .muted{color:var(--muted)}
  header{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;background:#0f172a;border-bottom:1px solid #0e203f}

  .wrap{padding:16px;height:calc(100vh - 58px);}
  .layout{height:100%;display:flex;gap:16px;overflow:hidden}
  .left,.right{flex:1;min-width:0;background:var(--panel);border:1px solid #1f2a44;border-radius:12px}
  .left{display:flex;flex-direction:column;padding:14px}
  .right{display:flex;flex-direction:column}
  .pane{flex:1;overflow:auto}

  .videoWrap{position:relative;width:100%;aspect-ratio:16/9;background:#000;border-radius:10px;overflow:hidden}
  .videoWrap video{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;background:#000}

  .controls{margin-top:12px;background:#0e2038;border:1px solid #183459;border-radius:12px;padding:12px}
  .controls .row{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin:.25rem 0}
  .speed{display:flex;align-items:center;gap:10px}
  input[type="range"]{width:260px;accent-color:var(--accent)}
  .chip{display:inline-flex;align-items:center;gap:6px;padding:7px 10px;border:1px solid #23446c;border-radius:10px;background:#10233d}

  .tabs{display:flex;gap:8px;padding:6px 10px;margin:0 0 2px;border-bottom:1px solid #1f2a44}
  .tab{cursor:pointer;background:#122340;border:1px solid #1f375f;border-radius:10px;padding:8px 12px}
  .tab.active{background:#154274}

  table{width:100%;border-collapse:collapse}
  th,td{padding:10px 12px;border-bottom:1px solid #162a48;vertical-align:top}
  tbody tr{background:#0f1f34}
  tbody tr:nth-child(2n){background:#0d1a2b}
  tbody tr:hover{background:#0f2a4e}
  tr.active{background:#173a6e}
  #pane-sub td:nth-child(2),#pane-sub td:nth-child(3){word-break:break-word;white-space:normal;line-height:1.6}

  .q-tabs{display:flex;gap:8px;flex-wrap:wrap}
  .q-tabs .qtab{background:#122340;border:1px solid #1f375f;border-radius:10px;padding:6px 12px;color:#e6efff;cursor:pointer}
  .q-tabs .qtab.on{background:#154274}

  .voc{border:1px solid #213a64;background:#0f223b;border-radius:12px;padding:12px;margin:10px 14px}
  .voc-h{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:6px}
  .voc-word{font-size:20px;font-weight:800}
  .voc-pos{opacity:.85}
  .voc-zh{color:#cfe2ff;margin-top:2px}
  .voc-en{color:#9fb0c9}
  .voc-actions{display:flex;gap:8px;margin-top:8px}

  /* ===== åˆ—å°æ¨£å¼ï¼ˆé—œéµè£œå¼·ï¼‰ ===== */
  @media print{
    html,body{ background:#fff !important; color:#000 !important; height:auto !important; }
    header,.tabs,.controls,#authArea,.drawer-grab{ display:none !important; }
    .wrap{ padding:0 !important; }
    .layout{ display:block !important; height:auto !important; overflow:visible !important; }
    .left{ display:none !important; }
    .right{ border:none !important; background:#fff !important; display:block !important; height:auto !important; }
    .pane, #pane-quiz, .quiz-shell, #quizList{
      height:auto !important; max-height:none !important; overflow:visible !important;
    }
    #pane-quiz{ display:block !important; }        /* åªå°æ¸¬é©— */
    #quizList{ font-size:12.5pt; line-height:1.25; }
    #quizList > li{
      break-inside:avoid; page-break-inside:avoid;     /* é¡Œç›®ä¸è¢«åˆ‡åŠ */
      padding:6px 0; margin:0 0 6px 0; border-bottom:1px dotted #ccc;
    }
    @page { margin:10mm 10mm 12mm 10mm; }           /* ç‰ˆé‚Š */
    #printHeader{ display:flex !important; }         /* é¡¯ç¤ºåˆ—å°é é¦– */
    #phScore{ font-size:22px; font-weight:900; }
  }
  /* åˆ—å°é é¦–ï¼ˆå¹³å¸¸éš±è—ã€åˆ—å°é¡¯ç¤ºï¼‰ */
  #printHeader{display:none; align-items:center; justify-content:space-between; padding:12px 8px 16px; margin:0 8px 8px; border-bottom:1px solid #ddd; color:#111; background:#fff;}
  #phLeft{display:flex;align-items:center;gap:10px}
  #phLogo{width:26px;height:26px}
  #phTitle{font-weight:800}
  #phMeta{font-size:12px;color:#444;margin-top:2px}
  #phRight{text-align:right}
  #phScore{font-size:24px;font-weight:900}
  #phFeedback{font-size:12px;color:#444}
</style>

<style id="patch-20251007-09">
.auth-locked { pointer-events:none; filter: grayscale(.05); opacity:.75; }
@media print { #authVersionBadge { display:none !important; } }
</style>


<!-- BEGIN Patch V20251007-11 (rebuilt): cues English/Chinese vertical stack -->
<style>
.cues-table { width: 100%; border-collapse: collapse; table-layout: fixed; }
.cues-table th, .cues-table td { padding: 10px 12px; vertical-align: top; }
.cue-time {
  width: 64px; min-width: 64px;
  color: rgba(255,255,255,.7);
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  white-space: nowrap;
}
.cue-en { line-height: 1.6; word-break: break-word; }
.cue-en .zh-line { margin-top: 6px; opacity: .9; }
.cue-zh { display: none !important; }
.cues-table tbody tr { border-top: 1px solid rgba(255,255,255,.06); }
.cues-table tbody tr:hover { background: rgba(255,255,255,.04); }
</style>
<!-- END Patch V20251007-11 -->

<!-- BEGIN Mobile Pager Styles Â· V20251007-15 -->
<style>
@media (max-width: 820px){
  body.is-mobile-pager{ overflow-x:hidden; }
  .mobile-tabs{
    position:sticky; top:0; z-index:45;
    display:flex; gap:8px; padding:8px; margin:0 -8px 4px;
    background:rgba(9,16,30,.9); backdrop-filter:saturate(160%) blur(6px);
    border-bottom:1px solid rgba(255,255,255,.08);
  }
  .mobile-tabs .tab{
    flex:1; padding:10px 12px; border-radius:12px;
    border:1px solid rgba(255,255,255,.18); color:#eaf1ff; background:transparent;
  }
  .mobile-tabs .tab.on{ background:rgba(255,255,255,.08); }

  #mobilePager{
    display:flex; overflow-x:auto; overflow-y:hidden;
    -webkit-overflow-scrolling:touch; scroll-snap-type:x mandatory;
    scroll-behavior:smooth;
    width:100%;
    height: calc(100vh - 60px); /* å¤§è‡´å¡«æ»¿å¯è¦–é«˜åº¦ */
  }
  #mobilePager::-webkit-scrollbar{ display:none; }
  .mobile-page{
    flex:0 0 100%; width:100%; max-width:100%;
    scroll-snap-align:start; overflow-y:auto; padding:8px;
  }
}
</style>
<!-- END Mobile Pager Styles Â· V20251007-15 -->

<!-- BEGIN Hide Login on Player Â· V20251007-16 -->
<style>
  /* Hide login (and optionally logout) button on player page only */
  #btnLogin { display:none !important; }
  /* è‹¥éœ€è¦ä¸€ä½µéš±è—ç™»å‡ºï¼Œå–æ¶ˆè¨»è§£ä¸‹ä¸€è¡Œ */
  /* #btnLogout { display:none !important; } */
</style>
<!-- END Hide Login on Player Â· V20251007-16 -->

<!-- BEGIN Quick CSS Fixes Â· V20251007-17 -->
<style>
  #btnLogin { display:none !important; }
  .version-pill, .build-badge { z-index: 9998; }
</style>
<!-- END Quick CSS Fixes Â· V20251007-17 -->
</head>
<body>

<!-- Version badge: V20251007-09 -->
<div id="authVersionBadge" style="position:fixed;top:10px;right:12px;z-index:99999;background:#fff;color:#111;font-weight:700;border-radius:10px;padding:4px 10px;box-shadow:0 2px 10px rgba(0,0,0,.15);font-family:ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Noto Sans TC',Arial;font-size:12px;">
  V20251007-09
  <span id="userBadgeEmail" style="margin-left:8px;opacity:.85;"></span>
</div>

<header>
  <h1>è‹±èªå½±ç‰‡æ’­æ”¾å™¨</h1>
  <div id="authArea" style="display:flex;gap:10px;align-items:center">
    <button id="btnLogin" class="btn">ç™»å…¥</button>
    <button id="btnLogout" class="btn" style="display:none">ç™»å‡º</button>
    <span id="userNameBadge" class="muted"></span>
  </div>
</header>

<div class="wrap">
  <div class="layout">
    <section class="left" id="videoContainer">
      <div id="videoWrap" class="videoWrap">
        <video id="player" playsinline controls></video>
      </div>

      <div class="controls" id="controlsDrawer">
        <div class="drawer-grab" id="drawerGrab">
          <div class="grab-bar" style="width:44px;height:4px;border-radius:4px;margin:0 auto 4px;background:#2b4a78;"></div>
          <div class="drawer-title" style="font-size:12px;color:#9fb0c9;">æ’­æ”¾å·¥å…·åˆ—ï¼ˆé»æ“Šå±•é–‹/æ”¶åˆï¼‰</div>
        </div>
        <div class="row">
          <button id="btnPrev" class="btn">â® ä¸Šä¸€å¥</button>
          <button id="btnPlay" class="btn">â–¶ï¸ æ’­æ”¾ / æš«åœ</button>
          <button id="btnNext" class="btn">â­ ä¸‹ä¸€å¥</button>
          <button id="btnReplay" class="btn">ğŸ” é‡è¤‡æœ¬å¥</button>
        </div>
        <div class="row">
          <label class="chip"><input id="chkFollow" type="checkbox"/> è·Ÿéš¨</label>
          <span class="chip">åç§» <span id="offsetVal">0.0s</span></span>
          <button id="btnOffsetMinus" class="btn">-0.5s</button>
          <button id="btnOffsetPlus" class="btn">+0.5s</button>
          <button id="btnAutoSync" class="btn">ğŸ§­ ç°¡æ˜“æ ¡æº–</button>
        </div>
        <div class="row speed">
          <span class="muted">é€Ÿåº¦</span>
          <input id="speedRange" type="range" min="0.5" max="2" step="0.05" value="1"/>
          <span id="speedVal">1.00x</span>
        </div>
      </div>
    </section>

    <section class="right" id="studyContainer">
      <div class="tabs">
        <div class="tab active" data-tab="sub" id="tabSub">å­—å¹•</div>
        <div class="tab" data-tab="quiz">æ¸¬é©—</div>
        <div class="tab" data-tab="vocab">å–®å­—</div>
      </div>

      <!-- åˆ—å°é é¦–ï¼ˆåˆ—å°æ™‚é¡¯ç¤ºï¼‰ -->
      <div id="printHeader" aria-hidden="true">
        <div id="phLeft">
          <!-- å…§åµŒ SVG Logo -->
          <svg id="phLogo" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <circle cx="12" cy="12" r="10" stroke="#111" stroke-width="2"></circle>
            <path d="M7 13h10M7 9h10M7 17h6" stroke="#111" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <div>
            <div id="phTitle">BookWide Â· è‹±èªå½±ç‰‡æ¸¬é©—æˆç¸¾å–®</div>
            <div id="phMeta">
              å½±ç‰‡ï¼š<span id="phSlug">-</span>ã€€åˆ†å€ï¼š<span id="phSection">-</span>ã€€åˆ—å°ï¼š<span id="phTime">-</span>
            </div>
          </div>
        </div>
        <div id="phRight">
          <div id="phScore">0 / 100</div>
          <div id="phFeedback">ï¼ˆ0%ï¼‰</div>
        </div>
      </div>

      <div class="pane">
        <div id="pane-sub">
          <div id="cuesStatus" class="muted" style="padding:10px 14px">ï¼ˆå­—å¹•è¼‰å…¥ä¸­â€¦ï¼‰</div>
          <table>
            <thead><tr><th style="width:80px">æ™‚é–“</th><th>è‹±æ–‡</th><th style="width:40%">ä¸­æ–‡</th></tr></thead>
            <tbody id="cuesBody"></tbody>
          </table>
        </div>

        <div id="pane-quiz" style="display:none">
          <div class="quiz-shell">
            <div id="quizTabs" class="q-tabs" style="margin:6px 0 10px 0;">
              <button class="qtab on" data-sec="Vocabulary">å–®å­—</button>
              <button class="qtab" data-sec="Grammar">æ–‡æ³•</button>
              <button class="qtab" data-sec="Reading">é–±è®€</button>
              <button class="qtab" data-sec="Mixed">ç¶œåˆ</button>
              <span id="quizMeta" class="muted" style="margin-left:12px">ï¼ˆæ¸¬é©—è¼‰å…¥ä¸­â€¦ï¼‰</span>
            </div>
            <ol id="quizList" style="line-height:1.6"></ol>
            <div class="q-actions" style="margin:14px 0 6px; display:flex; gap:8px; align-items:center;">
              <button class="btn" id="btnSubmitQuiz">äº¤å·</button>
              <button class="btn" id="btnShowAnswer" style="display:none">é¡¯ç¤ºç­”æ¡ˆ</button>
              <!-- åˆ—å°æŒ‰éˆ•ï¼ˆå¸¸é§é¡¯ç¤ºæ–¼æ¸¬é©—å€ï¼‰ -->
              <button class="btn" id="btnPrint" style="display:none">åˆ—å°æˆç¸¾å–®</button>
              <span id="quizScore" style="margin-left:8px"></span>
            </div>
            <div id="quizResult" style="display:none;margin-top:10px"></div>
          </div>
        </div>

        <div id="pane-vocab" style="display:none">
          <div id="vocabStatus" class="muted" style="padding:10px 14px">( å–®å­—è¼‰å…¥ä¸­â€¦ )</div>
          <div id="vocabBox" style="padding:0 14px 14px"></div>
        </div>
      </div>
    </section>
  </div>
</div>

<!-- ===== æ’­æ”¾å™¨ä¸»ç¨‹å¼ ===== -->
<script>
/* ---------- å°å·¥å…· ---------- */
const $=(s,e=document)=>e.querySelector(s);
const $$=(s,e=document)=>[...e.querySelectorAll(s)];
const toSec=t=>{ if(typeof t==='number')return t; const p=String(t).split(':').map(Number);
  if(p.length===3)return p[0]*3600+p[1]*60+p[2]; if(p.length===2)return p[0]*60+p[1]; return Number(t)||0; };
const fmt=sec=>{ sec=Math.max(0,sec|0); const m=(sec/60)|0,s=sec%60; return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;}
const esc=s=>String(s??'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');

/* ---------- åƒæ•¸ ---------- */
const params=new URLSearchParams(location.search);
const primarySlug=params.get('slug')||'mid-autumn';
let slug=primarySlug;

/* ---------- è³‡æºè¼‰å…¥ï¼ˆå«å›é€€ï¼‰ ---------- */
async function fetchWithFallback(p,f,kind){
  try{const r=await fetch(p,{cache:'no-store'}); if(!r.ok)throw 0; return {data:await r.json(),used:'primary'};}
  catch{ try{const r2=await fetch(f,{cache:'no-store'}); if(!r2.ok)throw 0; slug='mid-autumn'; return {data:await r2.json(),used:'fallback'};}
  catch(e2){ console.error(`[fatal] ${kind} è®€å–å¤±æ•—`,e2); return {data:null,used:'error'};}}
}

/* ---------- DOM ---------- */
const video=$('#player'); const cuesBody=$('#cuesBody'); const cuesStatus=$('#cuesStatus');
const btnPrev=$('#btnPrev'),btnPlay=$('#btnPlay'),btnNext=$('#btnNext'),btnReplay=$('#btnReplay');
const btnOffsetMinus=$('#btnOffsetMinus'),btnOffsetPlus=$('#btnOffsetPlus'),offsetVal=$('#offsetVal');
const chkFollow=$('#chkFollow'); const speedRange=$('#speedRange'),speedVal=$('#speedVal');
const btnAutoSync=$('#btnAutoSync'); const btnPrint=$('#btnPrint');
const paneSub=$('#pane-sub'),paneQuiz=$('#pane-quiz'),paneVocab=$('#pane-vocab');

let cues=[]; let offset=0; let loopSentence=false;
function setOffset(v){offset=Number(v)||0; offsetVal.textContent=`${offset.toFixed(1)}s`; localStorage.setItem(`offset:${slug}`,String(offset));}
window.player={ setOffset, clearRepeat:()=>{ loopSentence=false; btnReplay?.classList.remove('blue'); } };

/* ---------- å½±ç‰‡ & å­—å¹• ---------- */
async function loadVideo(){
  const src=s=>`./videos/${s}.mp4`;
  video.src=src(primarySlug);
  video.addEventListener('error',()=>{ video.src=src('mid-autumn'); },{once:true});
}
async function loadCues(){
  cuesStatus.textContent='ï¼ˆå­—å¹•è¼‰å…¥ä¸­â€¦ï¼‰';
  const {data,used}=await fetchWithFallback(`./data/cues-${primarySlug}.json?v=${Date.now()}`,`./data/cues-mid-autumn.json?v=${Date.now()}`,'cues');
  if(!data){ cuesStatus.textContent='âš ï¸ å­—å¹•è®€å–å¤±æ•—'; return; }
  cues=data.map(x=>({t:toSec(x.time),en:x.en||'',zh:x.zh||''}));
  cuesBody.innerHTML=cues.map((c,i)=>`<tr data-i="${i}"><td class="muted" style="width:80px">${c.t?fmt(c.t):''}</td><td>${esc(c.en)}</td><td style="width:40%">${esc(c.zh)}</td></tr>`).join('');
  $$('#cuesBody tr').forEach(tr=>tr.addEventListener('click',()=>{const i=+tr.dataset.i; seekTo(i,true);}));
  cuesStatus.textContent=used==='fallback' ? 'å·²è¼‰å…¥å­—å¹•ï¼ˆmid-autumn å›é€€ï¼‰' : `å·²è¼‰å…¥å­—å¹•ï¼ˆ${primarySlug}ï¼‰`;
}
function currentIndex(){ const t=video.currentTime+offset; let i=0; while(i+1<cues.length&&cues[i+1].t<=t+0.0001)i++; return i; }
function highlightRow(idx){ const trs=$$('#cuesBody tr'); trs.forEach(tr=>tr.classList.remove('active')); const tr=trs[idx]; if(!tr)return; tr.classList.add('active'); if(chkFollow.checked) tr.scrollIntoView({block:'center',behavior:'smooth'}); }
function seekTo(idx,play=true){ if(!cues[idx])return; video.currentTime=Math.max(0,cues[idx].t-offset+0.0001); highlightRow(idx); if(play) video.play(); }
function sentenceRange(i){ if(!cues[i])return[0,0]; const s=cues[i].t,e=(i+1<cues.length?cues[i+1].t:s+3); return[s,e]; }

/* ---------- æ¸¬é©— ---------- */
async function loadQuiz(){
  const listEl=$('#quizList',paneQuiz), metaEl=$('#quizMeta',paneQuiz);
  const {data,used}=await fetchWithFallback(`./data/quiz-${primarySlug}.json?v=${Date.now()}`,`./data/quiz-mid-autumn.json?v=${Date.now()}`,'quiz');
  if(!data){ metaEl.textContent='âš ï¸ é¡Œåº«è®€å–å¤±æ•—'; return; }

  let questions=[];
  if(Array.isArray(data)){
    questions=data.map(q=>({section:(q.section||'Mixed'),type:(String(q.type||'MCQ').toUpperCase()==='SA')?'SA':'MCQ',
      question:q.question||q.q||'',options:q.options||q.choices||[],answer:q.answer??q.ans??''}));
  }else if(data.sections){
    const push=(sec,arr=[])=>arr?.forEach(q=>questions.push({section:sec,type:(String(q.type||'MCQ').toUpperCase()==='SA')?'SA':'MCQ',
      question:q.question||'',options:q.options||[],answer:q.answer??''}));
    push('Vocabulary',data.sections.vocab); push('Grammar',data.sections.grammar);
    push('Reading',data.sections.reading); push('Mixed',data.sections.mixed);
  }
  metaEl.textContent=used==='fallback'?`å·²è¼‰å…¥ï¼ˆmid-autumn å›é€€ï¼‰ï¼Œå…± ${questions.length} é¡Œ`:`å·²è¼‰å…¥ï¼ˆ${primarySlug}ï¼‰ï¼Œå…± ${questions.length} é¡Œ`;

  function renderSection(sec){
    const arr=questions.filter(q=>q.section===sec);
    if(!arr.length){ listEl.innerHTML='<li style="color:#9fb3ff">ï¼ˆæ­¤åˆ†å€ç„¡é¡Œç›®ï¼‰</li>'; return; }
    listEl.innerHTML=arr.map((q,i)=>{
      const idx=i+1;
      if(q.type==='MCQ'){
        const opts=q.options.map(opt=>`<label style="display:block;margin:4px 0"><input type="radio" name="q${sec}-${idx}" value="${String(opt)}"> ${String(opt)}</label>`).join('');
        return `<li data-type="MCQ" data-ans="${String(q.answer)}"><div style="font-weight:700;margin:4px 0">${idx}. ${esc(q.question)}</div><div>${opts}</div><div class="msg" style="margin-top:4px"></div><div class="exp" style="margin-top:4px;color:#9fb3ff"></div></li>`;
      }else{
        return `<li data-type="SA" data-ans="${String(q.answer)}"><div style="font-weight:700;margin:4px 0">${idx}. ${esc(q.question)}</div><input type="text" placeholder="è¼¸å…¥ç­”æ¡ˆâ€¦" style="padding:6px 8px;border:1px solid #334155;border-radius:6px;background:#0f223b;color:#dbe7ff"><button class="btn btn-check" style="margin-left:6px">æª¢æŸ¥</button><div class="msg" style="margin-top:4px"></div><div class="exp" style="margin-top:4px;color:#9fb3ff"></div></li>`;
      }
    }).join('');
    listEl.addEventListener('click',e=>{
      if(!e.target.classList.contains('btn-check'))return;
      const li=e.target.closest('li'); const ipt=li.querySelector('input');
      const ok=(ipt.value||'').trim().toLowerCase()===String(li.dataset.ans||'').trim().toLowerCase();
      const msg=li.querySelector('span.msg')||li.querySelector('.msg'); const exp=li.querySelector('.exp');
      msg.textContent=ok?'âœ… æ­£ç¢º':'âŒ éŒ¯èª¤'; msg.style.color=ok?'#5bd3c7':'#ff6b6b'; exp.textContent=ok?'':`æ­£è§£ï¼š${li.dataset.ans}`;
    },{once:true});
  }
  $('#quizTabs').querySelectorAll('.qtab').forEach(b=>{ b.addEventListener('click',()=>{ $('#quizTabs').querySelectorAll('.qtab').forEach(x=>x.classList.remove('on')); b.classList.add('on'); renderSection(b.dataset.sec); }); });
  renderSection('Vocabulary');

  $('#btnSubmitQuiz').onclick=()=>{
    const items=[...$('#quizList').querySelectorAll('li')]; if(!items.length)return;
    let got=0,total=items.length;
    items.forEach(li=>{
      const ans=String(li.dataset.ans||'').trim();
      if(li.dataset.type==='MCQ'){
        const sel=li.querySelector('input[type="radio"]:checked'); const user=sel?sel.value:''; const ok=user===ans;
        if(ok)got++; const msg=li.querySelector('.msg'),exp=li.querySelector('.exp');
        msg.textContent=ok?'âœ… æ­£ç¢º':'âŒ éŒ¯èª¤'; msg.style.color=ok?'#5bd3c7':'#ff6b6b'; if(!ok)exp.textContent=`æ­£è§£ï¼š${ans}`;
      }else{
        const ipt=li.querySelector('input'); const ok=(ipt.value||'').trim().toLowerCase()===ans.toLowerCase(); if(ok)got++;
        const msg=li.querySelector('.msg'),exp=li.querySelector('.exp');
        msg.textContent=ok?'âœ… æ­£ç¢º':'âŒ éŒ¯èª¤'; msg.style.color=ok?'#5bd3c7':'#ff6b6b'; if(!ok)exp.textContent=`æ­£è§£ï¼š${ans}`;
      }
    });
    const score=got*5, full=total*5;
    $('#quizScore').textContent=`æœ¬åˆ†å€åˆ†æ•¸ï¼š${score} / ${full}`;
    $('#quizResult').style.display='block';
    $('#btnShowAnswer').style.display='inline-block';
    btnPrint.style.display='inline-block';
    // æ›´æ–°åˆ—å°é é¦–è³‡è¨Š
    updatePrintHeader(score, full);
  };
  $('#btnShowAnswer').onclick=()=>{ $('#quizList').querySelectorAll('li').forEach(li=>{ const exp=li.querySelector('.exp'); if(exp&&!exp.textContent) exp.textContent=`æ­£è§£ï¼š${li.dataset.ans}`; }); };

  /* ===== åˆ—å°ï¼ˆä½¿ç”¨å¼·åŒ–éçš„ CSSï¼›é€™è£¡åªè² è²¬è£œä¸Šé é¦–è³‡è¨Šï¼‰ ===== */
  function updatePrintHeader(score, full){
    const pct = full ? Math.round((score/full)*100) : 0;
    const words = pct>=90 ? 'å¤ªå¼·äº†ï¼' : pct>=75 ? 'å¾ˆæ£’ï¼Œç¹¼çºŒåŠ æ²¹ï¼' : pct>=60 ? 'é‚„å¯ä»¥ï¼Œå†ç·´ç·´æœƒæ›´å¥½ã€‚' : 'å…ˆåˆ¥ç°å¿ƒï¼é‡ä½œéŒ¯é¡Œã€èƒŒé—œéµå­—å†è©¦ä¸€æ¬¡æœƒæ›´å¥½ã€‚';
    $('#phSlug').textContent = slug;
    $('#phSection').textContent = $('#quizTabs .qtab.on')?.textContent?.trim() || 'Vocabulary';
    $('#phTime').textContent = new Date().toLocaleString('zh-TW', { hour12:false });
    $('#phScore').textContent = `${score} / ${full}`;
    $('#phFeedback').textContent = `ï¼ˆ${pct}%ï¼‰${words}`;
  }
  // è®“ 20 é¡Œå®Œæ•´é¡¯ç¤ºï¼šå…¶å¯¦é¡Œç›®æœ¬ä¾†å°±éƒ½åœ¨ DOMï¼Œä¸­é€”ä¸å†å‹• displayï¼Œäº¤çµ¦ @media print è² è²¬é«˜åº¦/åˆ†é 

  // åˆ—å°æŒ‰éˆ•ï¼šé–‹å°å‰å†ä¿éšªæŠ“ä¸€æ¬¡åˆ†æ•¸ï¼ˆé¿å…æ²’äº¤å·ä¹Ÿèƒ½å°ï¼‰
  btnPrint.onclick=()=>{
    let s=0,f=0;
    const m=($('#quizScore').textContent||'').match(/(\d+)\s*\/\s*(\d+)/);
    if(m){ s=+m[1]; f=+m[2]; }
    updatePrintHeader(s,f||100);
    window.print();
  };
  // ä½¿ç”¨è€…ç›´æ¥ Ctrl+P æ™‚ä¹Ÿè£œé é¦–
  window.addEventListener('beforeprint',()=>{
    let s=0,f=100;
    const m=($('#quizScore').textContent||'').match(/(\d+)\s*\/\s*(\d+)/);
    if(m){ s=+m[1]; f=+m[2]; }
    updatePrintHeader(s,f);
  });
}

/* ---------- å­—å½™å¡ ---------- */
async function loadVocab(){
  const vStatus=$('#vocabStatus'), vBox=$('#vocabBox');
  const {data,used}=await fetchWithFallback(`./data/vocab-${primarySlug}.json?v=${Date.now()}`,`./data/vocab-mid-autumn.json?v=${Date.now()}`,'vocab');
  if(!data||!data.length){ vStatus.textContent='âš ï¸ æŸ¥ç„¡å–®å­—è³‡æ–™'; vBox.innerHTML=''; return; }
  vStatus.textContent=used==='fallback'?'å·²è¼‰å…¥å–®å­—ï¼ˆmid-autumn å›é€€ï¼‰':`å·²è¼‰å…¥å–®å­—ï¼ˆ${primarySlug}ï¼‰`;
  const go=t=>{ const p=toSec(t); video.currentTime=Math.max(0,p); video.play(); };
  vBox.innerHTML=data.map(v=>`<div class="voc"><div class="voc-h"><div class="voc-word">${esc(v.word||'')}</div><div class="voc-pos">${esc(v.pos||'')}</div></div>${v.zh?`<div class="voc-zh">${esc(v.zh)}</div>`:''}${v.en?`<div class="voc-en">${esc(v.en)}</div>`:''}<div class="voc-actions">${v.time?`<button class="btn" data-act="jump" data-time="${esc(v.time)}">è·³åˆ°ç‰‡æ®µ</button>`:''}<button class="btn" data-act="speak" data-text="${esc(v.word||v.en||'')}">ğŸ”Š æœ—è®€</button></div></div>`).join('');
  vBox.addEventListener('click',e=>{
    const act=e.target?.dataset?.act; if(!act)return;
    if(act==='jump')go(e.target.dataset.time||0);
    if(act==='speak'){ try{ const u=new SpeechSynthesisUtterance(e.target.dataset.text||''); u.lang='en-US'; speechSynthesis.cancel(); speechSynthesis.speak(u);}catch{} }
  });
}

/* ---------- æ§åˆ¶ ---------- */
speedRange.addEventListener('input',()=>{ const r=Number(speedRange.value)||1; video.playbackRate=r; speedVal.textContent=`${r.toFixed(2)}x`; });
btnPlay.addEventListener('click',()=>{ if(video.paused) video.play(); else video.pause(); });
btnPrev.addEventListener('click',()=>seekTo(Math.max(0,currentIndex()-1),true));
btnNext.addEventListener('click',()=>seekTo(Math.min(cues.length-1,currentIndex()+1),true));
(function(){ const btn=btnReplay; const on=()=>{btn.dataset.active='1';btn.classList.add('blue')}; const off=()=>{btn.dataset.active='0';btn.classList.remove('blue');loopSentence=false}; off(); btn.addEventListener('click',function(e){ const isOn=btn.dataset.active==='1'; if(isOn){ e.stopImmediatePropagation(); window.player.clearRepeat(); off(); return; } loopSentence=true; on(); seekTo(currentIndex(),true); },true); })();
btnOffsetMinus.addEventListener('click',()=>setOffset(offset-0.5));
btnOffsetPlus .addEventListener('click',()=>setOffset(offset+0.5));

video.addEventListener('timeupdate',()=>{ if(!cues.length)return; const i=currentIndex(); highlightRow(i); if(loopSentence){ const [s,e]=sentenceRange(i); const t=video.currentTime+offset; if(t>=e-0.02){ video.currentTime=Math.max(0,s-offset+0.0001); video.play(); } } });

(function(){ const drawer=$('#controlsDrawer'),grab=$('#drawerGrab'); if(!drawer||!grab)return; const toggle=()=>drawer.classList.toggle('open'); grab.addEventListener('click',toggle); })();

function showTab(name){
  paneSub.style.display=name==='sub'?'':'none';
  paneQuiz.style.display=name==='quiz'?'':'none';
  paneVocab.style.display=name==='vocab'?'':'none';
  $$('.tabs .tab').forEach(t=>t.classList.toggle('active',t.dataset.tab===name));
}
$$('.tabs .tab').forEach(t=>t.addEventListener('click',()=>showTab(t.dataset.tab)));

/* ---------- åˆå§‹åŒ– ---------- */
(async function init(){
  // æ’­æ”¾åƒæ•¸
  const saved=localStorage.getItem(`offset:${slug}`); if(saved!=null) setOffset(parseFloat(saved)); else setOffset(0);
  const r=Number(speedRange.value)||1; video.playbackRate=r; speedVal.textContent=`${r.toFixed(2)}x`;

  await loadVideo(); await loadCues(); await loadQuiz(); await loadVocab();
  showTab('sub');
})();
</script>

<!-- ===== Supabase å®ˆé–€ & è§€çœ‹ç´€éŒ„ ===== -->
<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

  const SUPABASE_URL = "https://qtgwedankftrqjmzuset.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF0Z3dlZGFua2Z0cnFqbXp1c2V0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4NDYxMDMsImV4cCI6MjA3NDQyMjEwM30.jyETpt09pgm66aCZheMgsjtbKlVmYo-lt-hrrt6BF8g";

  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // å¿…é ˆç™»å…¥
  const { data: authData, error: authErr } = await supabase.auth.getUser();
  if (authErr || !authData?.user) {
    alert("è«‹å…ˆç™»å…¥å¾Œå†è§€çœ‹å½±ç‰‡ã€‚");
    location.href = "index.html";
  } else {
    const user = authData.user;
    const videoSlug = new URLSearchParams(location.search).get("slug") || "mid-autumn";

    // ç¬¬ä¸€æ¬¡æ’­æ”¾å¯«ä¸€ç­†ç´€éŒ„
    let hasLogged = false;
    const logOnce = async () => {
      if (hasLogged) return;
      hasLogged = true;
      try {
        await supabase.from("watch_logs").insert({
          user_id: user.id,
          email: user.email,
          video_slug: videoSlug
          // viewed_at äº¤çµ¦ DB default now()
        });
      } catch (e) {
        console.warn("watch_logs å¯«å…¥å¤±æ•—ï¼š", e?.message || e);
      }
    };
    document.getElementById("player")?.addEventListener("play", logOnce, { once: true });
  }
</script>

<!-- Supabase Auth Gate + PDF Export (player_v20251007-09, non-invasive) -->
<script>
(function(){
  const SUPABASE_URL = 'https://qtgwedankftrqjmzuset.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF0Z3dlZGFua2Z0cnFqbXp1c2V0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4NDYxMDMsImV4cCI6MjA3NDQyMjEwM30.jyETpt09pgm66aCZheMgsjtbKlVmYo-lt-hrrt6BF8g';

  const $ = (s, r=document)=>r.querySelector(s);
  const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));

  function ensureSupabase() {
    return new Promise((resolve)=>{
      if (window.supabase && window.supabase.createClient) return resolve(window.supabase);
      const s = document.createElement('script');
      s.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
      s.onload = ()=>resolve(window.supabase);
      document.head.appendChild(s);
    });
  }

  function showGate(open){
    if (typeof window.showGate === 'function') { window.showGate(open); return; }
    let bar = $('#loginGateLite');
    if (!bar) {
      bar = document.createElement('div');
      bar.id = 'loginGateLite';
      bar.style.cssText = 'position:fixed;left:0;right:0;bottom:0;background:rgba(15,23,42,.96);color:#e5edff;z-index:99998;padding:14px;border-top:1px solid rgba(255,255,255,.12)';
      bar.innerHTML = '<div style="max-width:980px;margin:0 auto;display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap"><strong>éœ€è¦ç™»å…¥</strong><span style="opacity:.85">è«‹å…ˆç™»å…¥ä»¥ç¹¼çºŒä½¿ç”¨ã€‚</span><div style="margin-left:auto;display:flex;gap:8px;"><button id="gateLoginLite" style="background:#2563eb;color:#fff;border:0;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer;">ä»¥ Google ç™»å…¥</button></div></div>';
      document.body.appendChild(bar);
      $('#gateLoginLite').addEventListener('click', async ()=>{
        const { data, error } = await supabase.auth.signInWithOAuth({ provider:'google', options:{ redirectTo: location.href } });
      });
    }
    bar.style.display = open ? 'block' : 'none';
  }

  function setLocked(locked){
    const areas = [
      '#rightPanel','.right-panel','.tabs','.tab','#tabSubtitle','#tabQuiz','#tabWords',
      'video','#player','.controls','.toolbar','.player-controls'
    ];
    areas.forEach(sel => {
      $$(sel).forEach(el => {
        if (locked){
          el.classList.add('auth-locked');
          el.setAttribute('data-auth-locked','1');
          if (el.tagName === 'VIDEO') { try{ el.pause(); }catch(_){} }
        }else{
          if (el.hasAttribute('data-auth-locked')){
            el.classList.remove('auth-locked');
            el.removeAttribute('data-auth-locked');
          }
        }
      });
    });
  }

  let supabase, userEmail = '';

  async function checkAuthOnce(){
    try{
      const { data } = await supabase.auth.getUser();
      return data && data.user ? data.user : null;
    }catch(e){
      return null;
    }
  }

  async function ensureAuthLoop(maxRetry=8, delay=500){
    for (let i=0;i<maxRetry;i++){
      const u = await checkAuthOnce();
      if (u) return u;
      await new Promise(r=>setTimeout(r, delay));
    }
    return null;
  }

  async function boot(){
    await ensureSupabase();
    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    showGate(false);
    setLocked(false);

    let user = await checkAuthOnce();
    if (!user) user = await ensureAuthLoop(8, 500);

    if (user){
      userEmail = user.email || '';
      const badge = $('#userBadgeEmail'); if (badge) badge.textContent = userEmail;
      setLocked(false); showGate(false);
    }else{
      userEmail = '';
      setLocked(true); showGate(true);
    }

    supabase.auth.onAuthStateChange((_evt, session)=>{
      if (session?.user){
        userEmail = session.user.email || '';
        const badge = $('#userBadgeEmail'); if (badge) badge.textContent = userEmail;
        setLocked(false); showGate(false);
      }else{
        userEmail = '';
        const badge = $('#userBadgeEmail'); if (badge) badge.textContent = '';
        setLocked(true); showGate(true);
      }
    });

    const tabSelectors = ['[data-tab="subtitle"]','[data-tab="quiz"]','[data-tab="vocab"]','#tabSubtitle','#tabQuiz','#tabWords'];
    tabSelectors.forEach(sel=>{
      $$(sel).forEach(el=>{
        el.addEventListener('click', async (e)=>{
          const u = await checkAuthOnce();
          if (!u){
            e.preventDefault(); e.stopPropagation();
            showGate(true);
          }
        }, true);
      });
    });

    wirePdfExport();
  }

  function wirePdfExport(){
    function ensureJsPDF(){
      return new Promise((resolve)=>{
        if (window.jspdf && window.jspdf.jsPDF) return resolve(window.jspdf);
        const s = document.createElement('script');
        s.src = 'https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js';
        s.onload = ()=>resolve(window.jspdf);
        document.head.appendChild(s);
      });
    }

    async function exportPdf(){
      const { jsPDF } = await ensureJsPDF();
      const doc = new jsPDF({ unit:'pt', format:'a4' });

      const line = (y)=>{ doc.setDrawColor(200); doc.line(40,y,555,y); };

      const slug = new URLSearchParams(location.search).get('slug') || '';
      const scoreText = (document.querySelector('[data-score-now]')?.textContent || document.querySelector('.score-value')?.textContent || '').trim();
      const quizRoot = document.querySelector('#quizPanel, .quiz-container, [data-quiz-root], #testPanel, #rightPanel') || document.body;
      const textDump = (quizRoot.innerText || '').replace(/
{3,}/g, '

').slice(0, 12000);

      let y = 60;
      doc.setFont('helvetica','bold'); doc.setFontSize(16);
      doc.text('è‹±èªå½±ç‰‡ï¼šæ¸¬é©—æˆç¸¾å–®', 40, y);
      doc.setFont('helvetica',''); doc.setFontSize(10);
      const dt = new Date(); const ts = dt.toISOString().slice(0,19).replace('T',' ');
      const email = (document.querySelector('#userBadgeEmail')?.textContent || '').trim();
      doc.text(`å¸³è™Ÿï¼š${email || 'ï¼ˆæœªç™»å…¥ï¼‰'}`, 40, y += 20);
      doc.text(`å½±ç‰‡ï¼š${slug || '-'}`, 300, y);
      doc.text(`æ™‚é–“ï¼š${ts}`, 40, y += 16);
      doc.text(`åˆ†æ•¸ï¼š${scoreText || '-'}`, 300, y);
      line(y += 14); y += 20;

      doc.setFontSize(11);
      const lines = doc.splitTextToSize(textDump, 515);
      for (let i=0;i<lines.length;i++){
        if (y > 770){ doc.addPage(); y = 60; }
        doc.text(lines[i], 40, y);
        y += 14;
      }
      const safeTs = ts.replace(/[: ]/g,'-');
      doc.save(`score_${slug || 'quiz'}_${safeTs}.pdf`);
    }

    const selectors = ['#btnPrintScore','[data-action="print-score"]','#btnPrint','.btn-print-score','#btnDownloadPDF','[data-action="download-pdf"]'];
    selectors.forEach(sel=>{
      $$(sel).forEach(btn=>{
        if (btn._pdfBound) return;
        btn.addEventListener('click', async (e)=>{
          e.preventDefault(); e.stopPropagation();
          const { data } = await supabase.auth.getUser();
          if (!data || !data.user) { showGate(true); return; }
          exportPdf();
        });
        btn._pdfBound = true;
        if (/åˆ—å°/.test(btn.textContent)) btn.textContent = 'ä¸‹è¼‰ PDF æˆç¸¾';
      });
    });

    window.__wirePdfExport = wirePdfExport;
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', boot);
  } else {
    boot();
  }
})();
</script>


<!-- ğŸ” Supabase Gate Â· V20251007-10 (append-only) -->
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
(() => {
  if (window.__gateV20251007_10__) return;
  window.__gateV20251007_10__ = true;

  const SUPABASE_URL = 'https://qtgwedankftrqjmzuset.supabase.co';
  const SUPABASE_ANON_KEY =
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF0Z3dlZGFua2Z0cnFqbXp1c2V0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4NDYxMDMsImV4cCI6MjA3NDQyMjEwM30.jyETpt09pgm66aCZheMgsjtbKlVmYo-lt-hrrt6BF8g';

  const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  function ensureOverlay() {
    let o = document.getElementById('loginGateOverlay');
    if (!o) {
      o = document.createElement('div');
      o.id = 'loginGateOverlay';
      o.style.cssText =
        'position:fixed;inset:0;background:rgba(0,0,0,.86);color:#fff;z-index:2147483000;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:24px;line-height:1.8';
      o.innerHTML = `
        <div style="font-size:22px;margin-bottom:16px">ğŸ”’ è«‹å…ˆç™»å…¥ä»¥ä½¿ç”¨æœ¬å…§å®¹</div>
        <button id="gateToIndex"
          style="padding:10px 18px;border:0;border-radius:10px;background:#2563eb;color:#fff;font-weight:700;cursor:pointer">
          è¿”å›ç™»å…¥é 
        </button>
      `;
      document.body.appendChild(o);
      o.querySelector('#gateToIndex').onclick = () => location.href = 'index.html';
    }
    return o;
  }

  function showOverlay() { ensureOverlay().style.display = 'flex'; }
  function hideOverlay() { const o = document.getElementById('loginGateOverlay'); if (o) o.style.display = 'none'; }
  function setEmail(email) {
    const box = document.getElementById('userEmailDisplay');
    if (box) box.textContent = email || '';
  }

  async function syncAuth() {
    try {
      const { data: { session } } = await sb.auth.getSession();
      if (session?.user) {
        setEmail(session.user.email || '');
        hideOverlay();
      } else {
        showOverlay();
      }
    } catch (e) {
      console.warn('[gate] getSession failed:', e);
      showOverlay();
    }
  }

  sb.auth.onAuthStateChange((_ev, session) => {
    if (session?.user) {
      setEmail(session.user.email || '');
      hideOverlay();
    } else {
      showOverlay();
    }
  });

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', syncAuth, { once:true });
  } else {
    syncAuth();
  }
})();
</script>
<!-- /Supabase Gate Â· V20251007-10 -->


<!-- BEGIN Patch V20251007-11 (rebuilt): cues English/Chinese vertical stack -->
<script>
(function stackBilingualUnderEnglish() {
  try {
    const table = document.querySelector('.cues-table')
               || document.querySelector('#cuesTable')
               || document.querySelector('table.cues');
    if (!table) return;
    const tbody = table.tBodies && table.tBodies[0];
    if (!tbody) return;
    const rows = Array.from(tbody.rows);
    rows.forEach(tr => {
      const tdTime = tr.querySelector('.cue-time') || tr.cells[0];
      const tdEn   = tr.querySelector('.cue-en')   || tr.cells[1];
      const tdZh   = tr.querySelector('.cue-zh')   || tr.cells[2];
      if (!tdEn || !tdZh) return;
      const zhHTML = (tdZh.innerHTML || '').trim();
      if (zhHTML && !tdEn.querySelector('.zh-line')) {
        const zhDiv = document.createElement('div');
        zhDiv.className = 'zh-line';
        zhDiv.innerHTML = zhHTML;
        tdEn.appendChild(zhDiv);
      }
      tdZh.style.display = 'none';
      if (tdTime) tdTime.classList.add('cue-time');
      tdEn.classList.add('cue-en');
      tdZh.classList.add('cue-zh');
    });
    const zhHeader = table.tHead ? (table.tHead.querySelector('.cue-zh') || (table.tHead.rows[0] && table.tHead.rows[0].cells[2])) : null;
    if (zhHeader) zhHeader.style.display = 'none';
  } catch (e) {
    console && console.warn && console.warn('[Patch V20251007-11] stackBilingualUnderEnglish error:', e);
  }
})();
</script>
<!-- END Patch V20251007-11 -->

<!-- BEGIN Supabase Protection Patch Â· V20251007-12 -->
<script>
(function protectSupabaseBlocks(){
  const SAFE_KEY = "SUPABASE_PLAYER_PROTECTED_V1";
  if (window[SAFE_KEY]) return;
  window[SAFE_KEY] = true;
  const backupKey = "supabase_player_backup_v1";
  function findBlocks(){
    const scripts = Array.from(document.scripts);
    return scripts.filter(s => /createClient\s*\(|Supabase Gate/i.test(s.textContent))
                  .map(s => s.outerHTML);
  }
  function saveBackup(){
    try{
      const blocks = findBlocks();
      if(blocks.length){
        localStorage.setItem(backupKey, JSON.stringify(blocks));
        console.info("[SupabaseProtect] å·²å‚™ä»½ Supabase ç¨‹å¼å€å¡Šã€‚");
      }
    }catch(e){}
  }
  function restoreIfMissing(){
    try{
      const exists = Array.from(document.scripts).some(s => /createClient\s*\(/.test(s.textContent));
      if(!exists){
        const backup = localStorage.getItem(backupKey);
        if(backup){
          const arr = JSON.parse(backup);
          arr.forEach(html=>{
            const frag = document.createRange().createContextualFragment(html);
            document.body.appendChild(frag);
          });
          console.warn("[SupabaseProtect] å·²è‡ªå‹•æ¢å¾© Supabase ç¨‹å¼ã€‚");
        }
      }
    }catch(e){}
  }
  document.addEventListener("DOMContentLoaded", saveBackup);
  setInterval(restoreIfMissing, 60000);
})();
</script>
<!-- END Supabase Protection Patch Â· V20251007-12 -->

<!-- BEGIN Cues Stack Observer Patch Â· V20251007-13 -->
<script>
(function cuesStackObserverPatch(){
  const READY_KEY = "CUES_STACK_OBSERVER_V1";
  if (window[READY_KEY]) return;
  window[READY_KEY] = true;

  function applyStack(table){
    if(!table) return;
    table.classList.add('cues-table');
    try{
      const thZh = table.tHead && table.tHead.rows[0] && table.tHead.rows[0].cells[2];
      if (thZh) thZh.style.display = 'none';
    }catch(e){}

    const tbody = table.tBodies && table.tBodies[0];
    if(!tbody) return;

    Array.from(tbody.rows).forEach(tr => {
      if (tr.dataset.stacked === '1') return;
      const tdTime = tr.cells[0];
      const tdEn   = tr.cells[1];
      const tdZh   = tr.cells[2];
      if (!tdTime || !tdEn || !tdZh) return;

      tdTime.classList.add('cue-time');
      tdEn.classList.add('cue-en');
      tdZh.classList.add('cue-zh');

      const zhHTML = (tdZh.innerHTML||'').trim();
      if (zhHTML && !tdEn.querySelector('.zh-line')){
        const zhDiv = document.createElement('div');
        zhDiv.className = 'zh-line';
        zhDiv.innerHTML = zhHTML;
        tdEn.appendChild(zhDiv);
      }
      tdZh.style.display = 'none';
      tr.dataset.stacked = '1';
    });
  }

  function findTable(){
    const tbody = document.getElementById('cuesBody');
    if (tbody && tbody.closest) {
      const table = tbody.closest('table');
      if (table) return table;
    }
    const tables = document.querySelectorAll('main table, #pane-sub table, table');
    return tables[0] || null;
  }

  function init(){
    const table = findTable();
    if (!table) return;
    applyStack(table);
    const tbody = table.tBodies && table.tBodies[0];
    if (!tbody) return;
    const mo = new MutationObserver(()=> applyStack(table));
    mo.observe(tbody, { childList:true, subtree:false });

    let tries = 5;
    const t = setInterval(()=>{
      applyStack(table);
      tries -= 1;
      if (tries<=0) clearInterval(t);
    }, 800);
  }

  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>
<!-- END Cues Stack Observer Patch Â· V20251007-13 -->

<!-- BEGIN Cues Format Protection Patch Â· V20251007-14 -->
<script>
(function protectCuesFormat(){
  const KEY="CUES_FORMAT_PROTECT_V1";
  if(window[KEY]) return; window[KEY]=true;

  // æœ€å°å¯é‹ä½œçš„ CSSï¼ˆè¬ä¸€åŸæœ¬ <style> è¢«ç§»é™¤ï¼Œå…ˆè£œä¸Šï¼‰
  const FALLBACK_CSS = `
  .cues-table{width:100%;border-collapse:collapse;table-layout:fixed}
  .cues-table th,.cues-table td{padding:10px 12px;vertical-align:top}
  .cue-time{width:64px;min-width:64px;color:rgba(255,255,255,.7);
            font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;white-space:nowrap}
  .cue-en{line-height:1.6;word-break:break-word}
  .cue-en .zh-line{margin-top:6px;opacity:.9}
  .cue-zh{display:none !important}
  .cues-table tbody tr{border-top:1px solid rgba(255,255,255,.06)}
  .cues-table tbody tr:hover{background:rgba(255,255,255,.04)}
  `;

  function ensureCSS(){
    if(!document.getElementById('cues-fallback-style')){
      const s=document.createElement('style');
      s.id='cues-fallback-style'; s.textContent=FALLBACK_CSS;
      (document.head||document.documentElement).appendChild(s);
    }
  }

  function getTable(){
    const tbody=document.getElementById('cuesBody');
    if(tbody && tbody.closest) return tbody.closest('table');
    const t=document.querySelector('main table, #pane-sub table, table');
    return t||null;
  }

  function applyStackOnce(){
    const table=getTable(); if(!table) return;
    table.classList.add('cues-table');
    // éš±è—è¡¨é ­ä¸­æ–‡æ¬„
    try{ const thZh=table.tHead && table.tHead.rows[0] && table.tHead.rows[0].cells[2]; if(thZh) thZh.style.display='none'; }catch(e){}

    const tbody=table.tBodies && table.tBodies[0]; if(!tbody) return;
    Array.from(tbody.rows).forEach(tr=>{
      const td0=tr.cells[0], td1=tr.cells[1], td2=tr.cells[2];
      if(!td0||!td1||!td2) return;
      td0.classList.add('cue-time'); td1.classList.add('cue-en'); td2.classList.add('cue-zh');
      // å·²å †ç–Šå°±è·³é
      if(td1.querySelector('.zh-line')){ td2.style.display='none'; return; }
      const zhHTML=(td2.innerHTML||'').trim();
      if(!zhHTML) return;
      const d=document.createElement('div'); d.className='zh-line'; d.innerHTML=zhHTML;
      td1.appendChild(d);
      td2.style.display='none';
    });
  }

  function isStacked(){
    const tbody=document.getElementById('cuesBody');
    if(!tbody || !tbody.rows || !tbody.rows.length) return false;
    const tr=tbody.rows[0], td1=tr && tr.cells && tr.cells[1];
    return !!(td1 && td1.querySelector('.zh-line'));
  }

  // åˆå§‹åŒ–èˆ‡è§€å¯Ÿ
  function init(){
    ensureCSS();
    if(!isStacked()) applyStackOnce();

    const table=getTable(); if(!table) return;
    const tbody=table.tBodies && table.tBodies[0]; if(!tbody) return;

    const mo=new MutationObserver(()=>{ ensureCSS(); if(!isStacked()) applyStackOnce(); });
    mo.observe(tbody,{childList:true,subtree:false});

    // é€±æœŸè£œæ•‘ï¼šé¿å…ç¬¬ä¸‰æ–¹ç¨‹å¼åœ¨æ™šä¸€æ­¥è¦†è“‹
    setInterval(()=>{ ensureCSS(); if(!isStacked()) applyStackOnce(); }, 15000);
  }

  if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', init);
  else init();
})();
</script>
<!-- END Cues Format Protection Patch Â· V20251007-14 -->

<!-- BEGIN Mobile Pager Script Â· V20251007-15 -->
<script>
(function mobileHorizontalPager(){
  const KEY="MOBILE_PAGER_V1";
  if(window[KEY]) return; window[KEY]=true;

  const mq = window.matchMedia("(max-width: 820px)");
  let state = { enabled:false, root:null, left:null, right:null, container:null, tabs:null, phLeft:null, phRight:null };

  // å˜—è©¦ä»¥å¤šçµ„ selector æ‰¾å·¦å³å…©æ¬„
  function pickOne(list){ for(const sel of list){ const el=document.querySelector(sel); if(el) return el; } return null; }
  function findLeft(){ return pickOne(["#pane-video","#pane-left","#videoPane","#player-left","#videoCol",".left-pane",".col-left",".video-pane","#video","#playerVideoWrap"]); }
  function findRight(){ return pickOne(["#pane-sub","#pane-right","#subPane","#subsPane","#sidebar",".right-pane",".col-right","#tabsWrap","#panel-sub"]); }
  function findCommonAncestor(a,b){
    if(!a || !b) return null;
    let cur=a; while(cur && !cur.contains(b)) cur = cur.parentElement;
    return cur || null;
  }

  function build(){
    const left=findLeft(), right=findRight();
    if(!left || !right) return false;
    const root = findCommonAncestor(left, right) || document.querySelector("main") || document.body;

    // å»ºç«‹å®¹å™¨èˆ‡å…©é 
    const tabs = document.createElement("div");
    tabs.className="mobile-tabs";
    tabs.innerHTML = `<button class="tab on" data-i="0">å½±ç‰‡</button><button class="tab" data-i="1">å­—å¹•ï¼æ¸¬é©—</button>`;

    const container = document.createElement("div");
    container.id = "mobilePager";

    const pageL = document.createElement("section"); pageL.className="mobile-page page-left";
    const pageR = document.createElement("section"); pageR.className="mobile-page page-right";

    // ä½”ä½æ¨™è¨˜ï¼Œæ–¹ä¾¿å›å¾©
    const phLeft = document.createElement("div"); phLeft.hidden=true;
    const phRight= document.createElement("div"); phRight.hidden=true;
    left.parentElement.insertBefore(phLeft, left);
    right.parentElement.insertBefore(phRight, right);

    pageL.appendChild(left);
    pageR.appendChild(right);
    container.appendChild(pageL);
    container.appendChild(pageR);

    // æ’åˆ° root è£¡ï¼Œç›¡é‡åœ¨åŸæœ¬å·¦æ¬„ä¹‹å‰
    root.insertBefore(tabs, phLeft);
    root.insertBefore(container, phLeft);

    // äº‹ä»¶ï¼šé» Tab æ²å‹•
    tabs.addEventListener("click", (e)=>{
      const b = e.target.closest(".tab"); if(!b) return;
      const i = Number(b.dataset.i||0);
      container.scrollTo({ left: i*container.clientWidth, behavior: "smooth" });
      tabs.querySelectorAll(".tab").forEach(t=>t.classList.toggle("on", t===b));
    });

    // äº‹ä»¶ï¼šæ»‘å‹•æ™‚åˆ‡æ› Tab ç‹€æ…‹
    container.addEventListener("scroll", ()=>{
      const i = Math.round(container.scrollLeft / Math.max(1, container.clientWidth));
      const btns = tabs.querySelectorAll(".tab");
      btns.forEach((t,idx)=> t.classList.toggle("on", idx===i));
    }, {passive:true});

    // é«˜åº¦å¾®èª¿ï¼ˆé¿å… iOS å·¥å…·åˆ—é«˜åº¦è®Šå‹•ï¼‰
    function fit(){
      const h = window.innerHeight || document.documentElement.clientHeight;
      container.style.height = Math.max(320, h - tabs.offsetHeight - 8) + "px";
    }
    window.addEventListener("resize", fit, {passive:true}); fit();

    // æš´éœ²ä»¥ä¾¿å¸è¼‰
    state = { enabled:true, root, left, right, container, tabs, phLeft, phRight };
    document.body.classList.add("is-mobile-pager");
    return true;
  }

  function destroy(){
    if(!state.enabled) return;
    const {left,right,phLeft,phRight,container,tabs} = state;
    try{
      // æ”¾å›åŸä½
      if(phLeft && left){ phLeft.replaceWith(left); }
      if(phRight && right){ phRight.replaceWith(right); }
      if(container && container.parentNode) container.remove();
      if(tabs && tabs.parentNode) tabs.remove();
    }catch(e){}
    document.body.classList.remove("is-mobile-pager");
    state.enabled=false;
  }

  function apply(){
    if(mq.matches){
      if(!state.enabled) build();
    }else{
      if(state.enabled) destroy();
    }
  }
  mq.addEventListener ? mq.addEventListener("change", apply) : mq.addListener(apply);
  document.addEventListener("DOMContentLoaded", apply);
  apply();
})();
</script>
<!-- END Mobile Pager Script Â· V20251007-15 -->

<!-- BEGIN Build Tag Updater Â· V20251007-16 -->
<script>
(function buildTagUpdater(){
  const TAG="V20251007-16";
  function apply(){
    // 1) æ—¢æœ‰ï¼š#buildTag / [data-build-tag] ç›´æ¥è¦†å¯«
    document.querySelectorAll('#buildTag,[data-build-tag]').forEach(el=>{ el.textContent = TAG; });
    // 2) è‹¥æ²’æœ‰ç¾æˆå¾½ç« ï¼Œæ‰¾å³ä¸Šè§’å¯ç”¨å®¹å™¨ï¼ˆnav æˆ– bodyï¼‰ï¼Œè£œä¸Šä¸€å€‹å°æµ®æ¨™
    if(!document.querySelector('#buildTag,[data-build-tag]')){
      const badge = document.createElement('div');
      badge.id = 'buildTag';
      badge.setAttribute('data-build-tag','1');
      badge.textContent = TAG;
      Object.assign(badge.style, {
        position:'fixed', zIndex: 9999, top:'8px', right:'8px',
        padding:'6px 10px', borderRadius:'999px',
        background:'rgba(255,255,255,.92)', color:'#111',
        font:'600 12px/1 ui-sans-serif,system-ui,Segoe UI,Arial',
        border:'1px solid rgba(0,0,0,.2)', boxShadow:'0 2px 8px rgba(0,0,0,.1)'
      });
      document.body.appendChild(badge);
    }
  }
  if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', apply);
  else apply();
})();
</script>
<!-- END Build Tag Updater Â· V20251007-16 -->


<!-- BEGIN Mobile Pager Portrait Fix Â· V20251007-16 -->
<script>
(function mobilePagerPortraitFix(){
  const KEY='MOBILE_PAGER_PORTRAIT_FIX_V1';
  if(window[KEY]) return; window[KEY]=true;

  // æ›´å¼·çš„å•Ÿç”¨æ¢ä»¶ï¼šè¡Œå‹•è£ç½® + ç›´å¼ï¼ˆæˆ–å¯¬åº¦ â‰¤ 920ï¼‰
  const mqW = window.matchMedia('(max-width: 920px)');
  const mqPortrait = window.matchMedia('(orientation: portrait)');
  const isMobileLike = () => ('ontouchstart' in window) || navigator.maxTouchPoints>0 || mqW.matches;
  const isPortrait = () => mqPortrait.matches || (window.innerHeight > window.innerWidth);

  // èˆ‡ V20251007-15 çš„ pager æºé€šï¼šå‘¼å«å®ƒçš„ apply()ï¼Œå¦å‰‡è‡ªè¡Œè§¸ç™¼ resize è®“å®ƒç”Ÿæ•ˆ
  function nudgePager(){
    try{ window.dispatchEvent(new Event('resize')); }catch(e){}
  }

  function ensurePager(){
    const should = isMobileLike() && isPortrait();
    const pager = document.getElementById('mobilePager');
    if(should && !pager){
      // å¦‚æœå…ˆå‰æ¨¡çµ„é‚„æ²’å»ºå¥½ï¼Œæ¨å®ƒä¸€ä¸‹
      nudgePager();
      setTimeout(nudgePager, 120);
      setTimeout(nudgePager, 360);
    }
  }

  function init(){
    ensurePager();
  }
  ['DOMContentLoaded','load','resize','orientationchange'].forEach(ev=>addEventListener(ev, ensurePager, {passive:true}));
  init();
})();
</script>
<!-- END Mobile Pager Portrait Fix Â· V20251007-16 -->
<!-- BEGIN Unified Badge + Login Hide + Pager Boost Â· V20251007-17 -->

<script>
(function unifiedFixes(){{
  const VERSION="V20251007-17";
  const params = new URLSearchParams(location.search);

  function hideLoginButtons(){{
    const byId = document.getElementById('btnLogin');
    if(byId) byId.style.display='none';
    const all = Array.from(document.querySelectorAll('a,button'));
    all.forEach(el=>{{
      const t=(el.textContent||'').trim();
      if(t==='ç™»å…¥') el.style.display='none';
    }});
  }}

  function unifyVersionBadges(){{
    if(params.get('noBadge')==='1'){{
      document.querySelectorAll('*').forEach(el=>{{
        if(/^V\d{{8}}-\d{{2}}$/.test((el.textContent||'').trim())) el.style.display='none';
      }});
      return;
    }}
    const candidates = Array.from(document.querySelectorAll('div,span,button,a')).filter(el=>/^V\d{{8}}-\d{{2}}$/.test((el.textContent||'').trim()));
    let kept = null;
    candidates.forEach((el,idx)=>{{
      if(!kept){{ kept = el; }}
      el.textContent = VERSION;
      if(idx>0) el.style.display='none';
      if(!el.id) el.id = 'buildTag';
      if(getComputedStyle(el).position==='static'){{ el.style.position='fixed'; el.style.top='8px'; el.style.right='8px'; }}
      el.style.zIndex = 9999;
      el.style.padding = '6px 10px';
      el.style.borderRadius = '999px';
      el.style.background = 'rgba(255,255,255,.92)';
      el.style.color = '#111';
      el.style.border = '1px solid rgba(0,0,0,.2)';
      el.style.boxShadow = '0 2px 8px rgba(0,0,0,.1)';
      el.setAttribute('data-build-tag','1');
    }});
    if(!candidates.length){{
      const badge=document.createElement('div');
      badge.id='buildTag'; badge.setAttribute('data-build-tag','1'); badge.textContent=VERSION;
      Object.assign(badge.style,{{position:'fixed',top:'8px',right:'8px',zIndex:9999,padding:'6px 10px',borderRadius:'999px',background:'rgba(255,255,255,.92)',color:'#111',border:'1px solid rgba(0,0,0,.2)',boxShadow:'0 2px 8px rgba(0,0,0,.1)'}});
      document.body.appendChild(badge);
    }}
  }}

  function enablePagerStrongly(){{
    const force = params.get('pager')==='1' || params.get('mobilePager')==='1';
    const isPortrait = () => window.innerHeight > window.innerWidth;
    const narrow = () => window.matchMedia('(max-width: 1024px)').matches;
    const mobileLike = () => ('ontouchstart' in window) || navigator.maxTouchPoints>0 || narrow();
    function nudge(){{ try{{ window.dispatchEvent(new Event('resize')); }}catch(e){{}} }}

    function ensure(){{
      if(!(mobileLike() && (isPortrait() || force))) return;
      if(document.getElementById('mobilePager')) return;

      function bySel(list){{ for(const s of list){{ const el=document.querySelector(s); if(el) return el; }} return null; }}
      let left = bySel(['#pane-video','#player-left','.left-pane','#videoPane','#videoCol','main video']) || document.querySelector('video');
      if(left && left.tagName==='VIDEO') left = left.closest('section,div,article') || left.parentElement;

      let right = bySel(['#pane-sub','#panel-sub','.right-pane','#tabsWrap','#subPane']);
      if(!right){{
        const candidates = Array.from(document.querySelectorAll('section,div,aside'));
        right = candidates.find(el=>/å­—å¹•|æ¸¬é©—|å–®å­—/.test((el.textContent||'')));
      }}
      if(!left || !right) return;

      const phL=document.createElement('div'); phL.hidden=true; left.parentElement && left.parentElement.insertBefore(phL,left);
      const phR=document.createElement('div'); phR.hidden=true; right.parentElement && right.parentElement.insertBefore(phR,right);

      const tabs = document.createElement('div');
      tabs.className='mobile-tabs';
      tabs.innerHTML = '<button class="tab on" data-i="0">å½±ç‰‡</button><button class="tab" data-i="1">å­—å¹•ï¼æ¸¬é©—</button>';

      const pager=document.createElement('div'); pager.id='mobilePager';
      const pL=document.createElement('section'); pL.className='mobile-page page-left';
      const pR=document.createElement('section'); pR.className='mobile-page page-right';
      pL.appendChild(left); pR.appendChild(right);
      pager.appendChild(pL); pager.appendChild(pR);

      const root = (phL.parentElement) || document.querySelector('main') || document.body;
      root.insertBefore(tabs, phL);
      root.insertBefore(pager, phL);

      function fit(){{
        const h = Math.max(320, (window.innerHeight||document.documentElement.clientHeight) - tabs.offsetHeight - 8);
        pager.style.height = h + 'px';
      }}
      window.addEventListener('resize', fit, {{passive:true}}); fit();

      tabs.addEventListener('click', (e)=>{{
        const b=e.target.closest('.tab'); if(!b) return;
        const i=Number(b.dataset.i||0);
        pager.scrollTo({{left:i*pager.clientWidth, behavior:'smooth'}});
        tabs.querySelectorAll('.tab').forEach((t,idx)=> t.classList.toggle('on', idx===i));
      }});

      pager.addEventListener('scroll', ()=>{{
        const i = Math.round(pager.scrollLeft / Math.max(1, pager.clientWidth));
        tabs.querySelectorAll('.tab').forEach((t,idx)=> t.classList.toggle('on', idx===i));
      }}, {{passive:true}});

      document.body.classList.add('is-mobile-pager');
    }}

    ensure();
    ['orientationchange','resize','DOMContentLoaded','load'].forEach(ev=> addEventListener(ev, ensure, {{passive:true}}));
    setTimeout(nudge, 120); setTimeout(nudge, 360); setTimeout(nudge, 800);
  }}

  function init(){{
    hideLoginButtons();
    unifyVersionBadges();
    enablePagerStrongly();
  }}
  if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', init);
  else init();
}})();
</script>

<!-- END Unified Badge + Login Hide + Pager Boost Â· V20251007-17 -->
<!-- BEGIN Resize Recursion Guard Â· V20251007-18 -->
<script>
(function preventResizeRecursion(){
  const KEY='RESIZE_RECURSION_GUARD_V1';
  if(window[KEY]) return; window[KEY]=true;
  const _dispatch = window.dispatchEvent;
  let inResize = false;
  window.dispatchEvent = function(ev){
    try{
      if(ev && ev.type === 'resize'){
        if(inResize) return true; // swallow nested resize to avoid sync recursion
        inResize = true;
        const r = _dispatch.call(this, ev);
        setTimeout(()=>{ inResize = false; }, 0);
        return r;
      }
      return _dispatch.call(this, ev);
    }catch(e){
      try{ return _dispatch.call(this, ev); }catch(_){ return false; }
    }
  };
})();
</script>
<!-- END Resize Recursion Guard Â· V20251007-18 -->


<!-- BEGIN Enforce Login-Hide & Single Badge Â· V20251007-18 -->
<script>
(function enforceUiTidiness(){
  const VER="V20251007-18";
  function hideLoginButtons(){
    // hide by id
    const idEl = document.getElementById('btnLogin'); if(idEl) idEl.style.display='none';
    // hide by text
    Array.from(document.querySelectorAll('a,button')).forEach(el=>{
      const t=(el.textContent||'').trim();
      if(t==='ç™»å…¥') el.style.display='none';
    });
  }
  function unifyBadge(){
    const nodes = Array.from(document.querySelectorAll('div,span,button,a'));
    const pillRe = /^V\d{8}-\d{2}$/;
    let first=null;
    nodes.forEach(el=>{
      const t=(el.textContent||'').trim();
      if(!pillRe.test(t)) return;
      el.textContent = VER;
      if(!first) first = el; else el.style.display='none';
      // style
      if(!el.id) el.id='buildTag';
      if(getComputedStyle(el).position==='static'){ el.style.position='fixed'; el.style.top='8px'; el.style.right='8px'; }
      el.style.zIndex=9999; el.style.padding='6px 10px'; el.style.borderRadius='999px';
      el.style.background='rgba(255,255,255,.92)'; el.style.color='#111'; el.style.border='1px solid rgba(0,0,0,.2)'; el.style.boxShadow='0 2px 8px rgba(0,0,0,.1)';
      el.setAttribute('data-build-tag','1');
    });
    if(!first){ // create if none
      const b=document.createElement('div'); b.id='buildTag'; b.textContent=VER; b.setAttribute('data-build-tag','1');
      Object.assign(b.style,{position:'fixed',top:'8px',right:'8px',zIndex:9999,padding:'6px 10px',borderRadius:'999px',background:'rgba(255,255,255,.92)',color:'#111',border:'1px solid rgba(0,0,0,.2)',boxShadow:'0 2px 8px rgba(0,0,0,.1)'});
      document.body.appendChild(b);
    }
  }
  const mo = new MutationObserver(()=>{ hideLoginButtons(); unifyBadge(); });
  mo.observe(document.documentElement, {subtree:true, childList:true});
  if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', ()=>{ hideLoginButtons(); unifyBadge(); });
  else { hideLoginButtons(); unifyBadge(); }
})();
</script>
<!-- END Enforce Login-Hide & Single Badge Â· V20251007-18 -->
</body>
</html>

















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































