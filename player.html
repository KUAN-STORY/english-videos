<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>播放器 · Stories</title>
  <style>
    body{margin:0;background:#0b1324;color:#e7eaf3;font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,sans-serif}
    .wrap{max-width:1100px;margin:0 auto;padding:24px 16px}
    .muted{color:#a9b3cf}
    #player{height:420px;background:#0f1a33;border:1px solid #203057;border-radius:12px;display:flex;align-items:center;justify-content:center}
  </style>
</head>
<body>
<div class="wrap">
  <h1>影片播放</h1>
  <div id="player">（這裡放你的播放器）</div>
  <p class="muted" id="info"></p>
</div>

<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

  const SUPABASE_URL  = 'https://<YOUR-PROJECT-REF>.supabase.co'; // ← 改成你的
  const SUPABASE_ANON = '<YOUR-ANON-KEY>';                         // ← 改成你的

  const supa = createClient(SUPABASE_URL, SUPABASE_ANON, {
    auth:{ persistSession:true, autoRefreshToken:true, detectSessionInUrl:false, storageKey:'sb-auth-english-videos-single' }
  });

  // 和首頁一致的白名單
  const FREE_SLUGS = new Set(['mid-autumn']);

  const slug = new URLSearchParams(location.search).get('slug') || '';
  document.getElementById('info').textContent = 'slug=' + slug;

  async function ensureAuth(){
    if(FREE_SLUGS.has(slug)) return true;
    const { data: { user } } = await supa.auth.getUser();
    if(user) return true;
    if(confirm('此內容需登入後才能觀看，現在就登入？')) location.href = './index.html';
    else location.href = './index.html';
    return false;
  }

  await ensureAuth();
</script>
</body>
</html>

