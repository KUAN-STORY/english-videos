<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BookWide｜結帳</title>
<style>
  :root{
    --bg:#0b1324;--panel:#0f172a;--border:#1f2a44;--ink:#e6efff;--muted:#9fb0c9;--accent:#3c7cff;--ok:#54d6bd;--danger:#ff6b6b;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);
    font-family:ui-sans-serif,system-ui,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif}
  a{color:inherit;text-decoration:none}
  .wrap{max-width:1000px;margin:0 auto;padding:22px 16px 60px}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
  h1{font-size:22px;margin:0}
  .muted{color:var(--muted)}
  .container{display:grid;grid-template-columns:1.1fr .9fr;gap:16px}
  @media(max-width:900px){.container{grid-template-columns:1fr}}
  .panel{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:14px}
  .panel h2{margin:0 0 10px;font-size:18px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
  label{display:block;font-size:13px;color:#cfe2ff;margin:6px 0 6px}
  input,select{width:100%;padding:10px;border-radius:10px;border:1px solid #2a3f63;background:#0f223b;color:#e6efff}
  .inline{display:flex;gap:10px;align-items:center}
  .hint{font-size:12px;color:#9fb0c9}
  .badge{display:inline-block;padding:4px 8px;border:1px solid #2c4168;border-radius:999px;background:#12233f;color:#d6e6ff;font-size:12px}
  .btn{padding:11px 14px;border-radius:12px;border:1px solid #214170;background:#16345c;color:#fff;font-weight:800;cursor:pointer}
  .btn.full{width:100%}
  .btn.ok{background:#0f3b3b;border-color:#1e6d6d}
  .btn:hover{filter:brightness(1.08)}
  .sum{display:flex;justify-content:space-between;margin:8px 0}
  .sum .label{color:#cfe2ff}
  .sum .val{font-weight:800}
  .total{font-size:20px}
  .kvs{display:flex;gap:8px;flex-wrap:wrap}
  .kvs .kv{background:#12233f;border:1px solid #1f2a44;border-radius:10px;padding:6px 10px;font-size:12px}
  .sep{height:1px;background:#17304f;margin:10px 0}
  .err{color:var(--danger);font-size:12px;margin-top:4px;display:none}
  .ok{color:var(--ok)}
  .cta{margin-top:10px}
  .back{display:inline-flex;align-items:center;gap:8px}
  /* 成功浮層 */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);z-index:50}
  .modal .box{width:min(520px,92vw);background:#0f172a;border:1px solid #1f2a44;border-radius:14px;padding:16px}
  .box h3{margin:0 0 8px}
  .box p{margin:6px 0;color:#d6e6ff}
  .box .order{background:#0e213a;border:1px solid #213a64;border-radius:10px;padding:10px;margin-top:8px}
  .box .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
  /* 列印小白單 */
  @media print{
    header,.btn,.modal{display:none!important}
    .wrap{padding:0}
    .panel{border:none}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>結帳</h1>
      <a class="back muted" href="pricing.html">← 返回方案</a>
    </header>

    <div class="container">
      <!-- 左：付款 / 發票資料 -->
      <section class="panel">
        <h2>付款資訊</h2>
        <div class="row">
          <div>
            <label>持卡人姓名</label>
            <input id="cardName" placeholder="王小明">
            <div class="err" id="eCardName">請輸入持卡人姓名</div>
          </div>
          <div>
            <label>聯絡 Email</label>
            <input id="email" type="email" placeholder="you@example.com">
            <div class="err" id="eEmail">請輸入正確 Email</div>
          </div>
        </div>

        <div class="row3">
          <div>
            <label>卡號</label>
            <input id="cardNo" inputmode="numeric" placeholder="4242 4242 4242 4242" maxlength="19">
            <div class="hint">示意欄位，尚未串接金流</div>
            <div class="err" id="eCardNo">請輸入正確卡號</div>
          </div>
          <div>
            <label>有效月/年 (MM/YY)</label>
            <input id="cardExp" inputmode="numeric" placeholder="12/29" maxlength="5">
            <div class="err" id="eCardExp">請輸入正確到期</div>
          </div>
          <div>
            <label>CVC</label>
            <input id="cardCvc" inputmode="numeric" placeholder="123" maxlength="4">
            <div class="err" id="eCardCvc">請輸入 3–4 位 CVC</div>
          </div>
        </div>

        <div class="sep"></div>

        <h2>發票資訊 <span class="badge">個人</span></h2>
        <div class="row">
          <div>
            <label>發票抬頭</label>
            <input id="invName" placeholder="個人或公司名稱">
          </div>
          <div>
            <label>統一編號（選填）</label>
            <input id="invNo" placeholder="8 碼數字">
          </div>
        </div>
        <div class="inline" style="margin-top:8px">
          <input type="checkbox" id="agree">
          <label for="agree" class="hint">我同意服務條款與自動續訂（隨時可取消）</label>
        </div>
        <div class="err" id="eAgree" style="margin-top:6px">請勾選同意條款</div>

        <div class="cta">
          <button id="btnPay" class="btn ok full">確認付款</button>
        </div>
      </section>

      <!-- 右：訂單摘要 -->
      <aside class="panel" id="summary">
        <h2>訂單摘要</h2>
        <div class="kvs" style="margin-bottom:8px">
          <div class="kv">方案：<span id="sPlan">-</span></div>
          <div class="kv">週期：<span id="sPeriod">-</span></div>
        </div>

        <div class="sep"></div>
        <div id="lineItems"></div>

        <div class="sep"></div>
        <div class="sum"><span class="label">小計</span><span class="val" id="sub">NT$0</span></div>
        <div class="sum"><span class="label">稅額（0%）</span><span class="val" id="tax">NT$0</span></div>
        <div class="sum total"><span class="label">應付金額</span><span class="val" id="total">NT$0</span></div>

        <div class="sep"></div>
        <div class="hint">結帳後系統會建立訂閱，扣款成功即開通會員。之後若要更換方案或取消，皆可在帳號頁操作。</div>
      </aside>
    </div>
  </div>

  <!-- 成功提示 -->
  <div class="modal" id="okModal" role="dialog" aria-modal="true" aria-labelledby="okTitle">
    <div class="box">
      <h3 id="okTitle">✅ 付款成功（示意）</h3>
      <p>目前尚未接上金流，這是前端流程演示。實際上線時請把「確認付款」改為呼叫你的金流 SDK。</p>
      <div class="order" id="receiptBox">
        <div><b>訂單編號：</b><span id="oid"></span></div>
        <div><b>方案／週期：</b><span id="rPlan"></span> / <span id="rPeriod"></span></div>
        <div><b>金額：</b><span id="rAmt"></span></div>
        <div><b>Email：</b><span id="rEmail"></span></div>
        <div><b>開立：</b><span id="rTime"></span></div>
      </div>
      <div class="actions">
        <button class="btn" onclick="window.print()">列印收據</button>
        <a class="btn ok" href="pricing.html">完成</a>
      </div>
    </div>
  </div>

<script>
/* --------- 價格表（與 pricing.html 一致） --------- */
const PRICE_TABLE = {
  month: { label: "月",   map: { story:200, music:200, movie:200, news:200, pro:200 } },
  half : { label: "半年", map: { story:1000, music:1000, movie:1000, news:1000, pro:1000 } },
  year : { label: "年",   map: { story:1800, music:1800, movie:1800, news:1800, pro:1800 } }
};
const PLAN_NAME = { story:"故事 Story", music:"音樂 Music", movie:"電影 Movie", news:"新聞 News", pro:"專業行業 Professions" };

/* --------- 解析 URL 參數 --------- */
const qp = new URLSearchParams(location.search);
const plan   = (qp.get('plan')   || 'story').toLowerCase();
const period = (qp.get('period') || 'month').toLowerCase();
const conf   = PRICE_TABLE[period] || PRICE_TABLE.month;
const unit   = conf.map[plan] ?? 200;

const sPlanEl   = document.getElementById('sPlan');
const sPeriodEl = document.getElementById('sPeriod');
const lineItems = document.getElementById('lineItems');
const subEl  = document.getElementById('sub');
const taxEl  = document.getElementById('tax');
const totEl  = document.getElementById('total');

/* --------- 畫面帶入 --------- */
sPlanEl.textContent   = PLAN_NAME[plan] || plan;
sPeriodEl.textContent = conf.label;

lineItems.innerHTML = `
  <div class="sum"><span class="label">${PLAN_NAME[plan] || plan}</span>
  <span class="val">NT$${unit.toLocaleString()}</span></div>
  <div class="hint">內容類別單一訂閱（${conf.label}費）</div>
`;

subEl.textContent = `NT$${unit.toLocaleString()}`;
taxEl.textContent = `NT$0`;
totEl.textContent = `NT$${unit.toLocaleString()}`;

/* --------- 表單驗證（前端示意） --------- */
const $ = s => document.querySelector(s);
const show = (el, on)=> el.style.display = on ? 'block':'none';

function onlyDigits(s=''){return s.replace(/\D+/g,'');}

function validate(){
  let ok = true;

  const name = $('#cardName').value.trim();
  const email= $('#email').value.trim();
  const no   = onlyDigits($('#cardNo').value);
  const exp  = $('#cardExp').value.trim();
  const cvc  = onlyDigits($('#cardCvc').value);
  const agree= $('#agree').checked;

  show($('#eCardName'), !name);
  show($('#eEmail'), !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email));
  show($('#eCardNo'), !(no.length===16||no.length===15));
  show($('#eCardExp'), !/^(0[1-9]|1[0-2])\/\d{2}$/.test(exp));
  show($('#eCardCvc'), !(cvc.length===3||cvc.length===4));
  show($('#eAgree'), !agree);

  ok = name && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)
      && (no.length===16||no.length===15)
      && /^(0[1-9]|1[0-2])\/\d{2}$/.test(exp)
      && (cvc.length===3||cvc.length===4)
      && agree;

  return ok;
}

/* --------- 付款（示意） --------- */
$('#btnPay').addEventListener('click', ()=>{
  if(!validate()) return;

  // 這裡本來要呼叫金流 SDK；先做成功模擬
  const oid = 'BW' + Math.random().toString(36).slice(2,8).toUpperCase();
  $('#oid').textContent    = oid;
  $('#rPlan').textContent  = PLAN_NAME[plan] || plan;
  $('#rPeriod').textContent= PRICE_TABLE[period]?.label || '月';
  $('#rAmt').textContent   = `NT$${unit.toLocaleString()}`;
  $('#rEmail').textContent = $('#email').value.trim();
  $('#rTime').textContent  = new Date().toLocaleString('zh-TW',{hour12:false});

  $('#okModal').style.display = 'flex';
});

/* --------- 卡號輸入：自動加空白 --------- */
$('#cardNo').addEventListener('input', e=>{
  const d = onlyDigits(e.target.value).slice(0,19);
  e.target.value = d.match(/.{1,4}/g)?.join(' ') || '';
});
$('#cardExp').addEventListener('input', e=>{
  let v = e.target.value.replace(/[^\d]/g,'').slice(0,4);
  if(v.length>=3) v = v.slice(0,2) + '/' + v.slice(2);
  e.target.value = v;
});
</script>
</body>
</html>
